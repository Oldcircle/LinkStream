const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DQR7Y_KF.js","assets/stream-CeehbguB.js","assets/struct-deserialize-DCusmjXY.js","assets/reverse-DeNl7JEN.js","assets/sticky-event-emitter-B3ySTSV4.js","assets/index-BatUtq4H.js","assets/3_3_2-jOTdHFWM.js","assets/h265-BZeEvzU-.js","assets/index-DNvqIkcQ.js","assets/index-CLkEVEXn.js","assets/index-D3sjn72F.js"])))=>i.map(i=>d[i]);
import{_ as c}from"./index-D3sjn72F.js";async function D(m,t){var v,p;let u=null;try{t("Requesting Android device via WebUSB...","info");const e=await c(()=>import("./index-CwCV73Rw.js"),[]),o=await c(()=>import("./index-DQR7Y_KF.js"),__vite__mapDeps([0,1,2,3,4])),n=await c(()=>import("./index-BatUtq4H.js"),__vite__mapDeps([5,6,2,1,7,4,3])),h=await c(()=>import("./index-DNvqIkcQ.js"),__vite__mapDeps([8,6,2,1,7])),y=await c(()=>import("./index-CLkEVEXn.js"),__vite__mapDeps([9,7,1,4,10]));if(!navigator.usb)throw new Error("WebUSB not available: use Chrome/Edge over HTTPS or localhost");const w=new e.AdbWebUsbBackend,S=[{vendorId:6353},{vendorId:1256},{vendorId:4817},{vendorId:10007},{vendorId:10864},{vendorId:8921},{vendorId:11669}];let a;try{a=await w.requestDevice({filters:S})}catch(i){if((i==null?void 0:i.name)==="NotFoundError")t("No matching Android device found with filters, showing all devices...","info"),a=await w.requestDevice({filters:[]});else throw i}if(!a)throw new Error("No device selected");const l=await a.connect(),d=new o.Adb(l);typeof d.connect=="function"&&await d.connect(),t("Starting scrcpy server on device...","info");const E=n.AdbScrcpyOptions2_1??n.AdbScrcpyOptions1_24,b=new E({video:{codec:"h264",maxSize:1080,bitRate:8e6,tunnel:"adb"},audio:!1,tunnelForward:!0});let r;try{r=await n.AdbScrcpyClient.start(d,h.DefaultServerPath,b)}catch{const g=new n.AdbScrcpyClient(d,b);try{r={streams:await g.start()}}catch(_){throw t("ADB unauthorized or scrcpy server failed to start. Please accept USB debugging dialog on device and try again.","error"),_}}const s=new y.ScrcpyDecoderWebCodecs({canvas:m}),f=r.videoStream??((v=r.streams)==null?void 0:v.video)??r.streams??r;if(!f)throw new Error("No video stream from scrcpy");t("Decoding H.264 stream via WebCodecs...","info"),typeof s.decode=="function"?s.decode(f):typeof s.render=="function"&&s.render(f),u=async()=>{try{typeof r.close=="function"&&await r.close(),typeof l.close=="function"&&await l.close()}catch{}},t("USB mirror started","success")}catch(e){console.error(e);let o="";throw(e==null?void 0:e.name)==="SecurityError"&&(o="SecurityError: use HTTPS (GitHub Pages) or localhost, and enable USB debugging."),(e==null?void 0:e.name)==="NotFoundError"&&(o="No device selected or no matching device; ensure phone is connected and unlocked."),(p=e==null?void 0:e.message)!=null&&p.includes("unauthorized")&&(o="Device unauthorized: accept the USB debugging prompt and check Developer options."),t(`USB mirror failed: ${(e==null?void 0:e.message)||e}${o?" | "+o:""}`,"error"),e}return{stop:async()=>{u&&await u(),t("USB mirror stopped","info")}}}export{D as startUsbMirror};

const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-V_WUKhLh.js","assets/stream-BT4ImN5b.js","assets/distribution-vvPj2d0I.js","assets/struct-deserialize-bkGssrR1.js","assets/encoding-D3q_jWej.js","assets/string-Gn2dS4oc.js","assets/uint32-BfumdTHg.js","assets/reverse-D3S_M3ap.js","assets/sticky-event-emitter-B3ySTSV4.js","assets/index-tKmTrm3T.js","assets/3_3_2-DmD8R-J5.js","assets/h265-BZeEvzU-.js","assets/split-string-NR4_hcTk.js","assets/index-CrHIl016.js","assets/index-C490ar1H.js","assets/index-BAdW189F.js","assets/index-Di93NhIW.js"])))=>i.map(i=>d[i]);
import{_ as a}from"./index-BAdW189F.js";async function T(D,o){var w,m,y,_,h,g;let b=null;try{o("Requesting Android device via WebUSB...","info");const e=await a(()=>import("./index-CwCV73Rw.js"),[]),n=await a(()=>import("./index-V_WUKhLh.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8])),c=await a(()=>import("./index-tKmTrm3T.js"),__vite__mapDeps([9,10,3,1,5,6,11,12,8,7,4])),U=await a(()=>import("./index-CrHIl016.js"),__vite__mapDeps([13,10,3,1,5,6,11])),E=await a(()=>import("./index-C490ar1H.js"),__vite__mapDeps([14,11,6,8,1,15])),s=await a(()=>import("./index-Di93NhIW.js"),__vite__mapDeps([16,3,1,2,4,12]));if(!navigator.usb)throw new Error("WebUSB not available: use Chrome/Edge over HTTPS or localhost");const S=[{vendorId:6353},{vendorId:1256},{vendorId:4817},{vendorId:10007},{vendorId:10864},{vendorId:8921},{vendorId:11669}];let r;try{typeof((w=e.AdbWebUsbBackend)==null?void 0:w.requestDevice)=="function"?r=await e.AdbWebUsbBackend.requestDevice({filters:S}):r=await navigator.usb.requestDevice({filters:S})}catch(t){if((t==null?void 0:t.name)==="NotFoundError")o("No matching Android device found with filters, showing all devices...","info"),typeof((m=e.AdbWebUsbBackend)==null?void 0:m.requestDevice)=="function"?r=await e.AdbWebUsbBackend.requestDevice({filters:[]}):r=await navigator.usb.requestDevice({filters:[]});else throw t}if(!r)throw new Error("No device selected");try{if(typeof r.open=="function"&&!r.opened&&await r.open(),typeof r.selectConfiguration=="function"&&r.configuration==null)try{await r.selectConfiguration(1)}catch{}}catch{}let p;if(typeof((y=e.AdbWebUsbBackend)==null?void 0:y.fromDevice)=="function")p=await e.AdbWebUsbBackend.fromDevice(r);else if(typeof e.AdbWebUsbBackend=="function")p=new e.AdbWebUsbBackend(r);else throw new Error("AdbWebUsbBackend not available");let d;try{d=await p.connect()}catch(t){throw String((t==null?void 0:t.message)||"").includes("claimInterface")&&o("Unable to claim USB ADB interface. On Windows, install WinUSB driver for the ADB interface (use Zadig or Google USB Driver), close OEM phone suites (HiSuite/Kies), replug the device, and ensure USB debugging is enabled.","error"),t}const u=new n.Adb(d);typeof u.connect=="function"&&await u.connect(),o("Starting scrcpy server on device...","info");const W=c.AdbScrcpyOptions2_1??c.AdbScrcpyOptions1_24,A=new W({video:{codec:"h264",maxSize:1080,bitRate:8e6,tunnel:"adb"},audio:!1,tunnelForward:!0});let i;try{i=await c.AdbScrcpyClient.start(u,U.DefaultServerPath,A)}catch{const l=new c.AdbScrcpyClient(u,A);try{i={streams:await l.start()}}catch(B){throw o("ADB unauthorized or scrcpy server failed to start. Please accept USB debugging dialog on device and try again.","error"),B}}if((_=i==null?void 0:i.output)!=null&&_.pipeTo&&(s!=null&&s.WritableStream))try{await i.output.pipeTo(new s.WritableStream({write(t){const l=typeof t=="string"?t:(()=>{try{return new TextDecoder().decode(t)}catch{return String(t)}})();o(`scrcpy: ${l}`,"info")}}))}catch{}const f=new E.ScrcpyDecoderWebCodecs({canvas:D}),v=i.videoStream??((h=i.streams)==null?void 0:h.video)??i.streams??i;if(!v)throw new Error("No video stream from scrcpy");o("Decoding H.264 stream via WebCodecs...","info"),typeof f.decode=="function"?f.decode(v):typeof f.render=="function"&&f.render(v),b=async()=>{try{typeof i.close=="function"&&await i.close(),typeof d.close=="function"&&await d.close()}catch{}},o("USB mirror started","success")}catch(e){console.error(e);let n="";(e==null?void 0:e.name)==="SecurityError"&&(n="SecurityError: use HTTPS (GitHub Pages) or localhost, and enable USB debugging."),(e==null?void 0:e.name)==="NotFoundError"&&(n="No device selected or no matching device; ensure phone is connected and unlocked."),(g=e==null?void 0:e.message)!=null&&g.includes("unauthorized")&&(n="Device unauthorized: accept the USB debugging prompt and check Developer options.");const c=JSON.stringify({name:e==null?void 0:e.name,message:e==null?void 0:e.message,stack:e==null?void 0:e.stack},null,2);throw o(`USB mirror failed: ${(e==null?void 0:e.message)||e}${n?" | "+n:""}
${c}`,"error"),e}return{stop:async()=>{b&&await b(),o("USB mirror stopped","info")}}}export{T as startUsbMirror};

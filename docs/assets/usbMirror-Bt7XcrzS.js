const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-V_WUKhLh.js","assets/stream-BT4ImN5b.js","assets/distribution-vvPj2d0I.js","assets/struct-deserialize-bkGssrR1.js","assets/encoding-D3q_jWej.js","assets/string-Gn2dS4oc.js","assets/uint32-BfumdTHg.js","assets/reverse-D3S_M3ap.js","assets/sticky-event-emitter-B3ySTSV4.js","assets/index-tKmTrm3T.js","assets/3_3_2-DmD8R-J5.js","assets/h265-BZeEvzU-.js","assets/split-string-NR4_hcTk.js","assets/index-CrHIl016.js","assets/index-CgBHeiJk.js","assets/index-BWSDxpB5.js","assets/index-Di93NhIW.js"])))=>i.map(i=>d[i]);
import{_ as n}from"./index-BWSDxpB5.js";async function T(S,o){var w,_,m;let l=null;try{o("Requesting Android device via WebUSB...","info");const e=await n(()=>import("./index-CwCV73Rw.js"),[]),i=await n(()=>import("./index-V_WUKhLh.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8])),c=await n(()=>import("./index-tKmTrm3T.js"),__vite__mapDeps([9,10,3,1,5,6,11,12,8,7,4])),g=await n(()=>import("./index-CrHIl016.js"),__vite__mapDeps([13,10,3,1,5,6,11])),E=await n(()=>import("./index-CgBHeiJk.js"),__vite__mapDeps([14,11,6,8,1,15])),a=await n(()=>import("./index-Di93NhIW.js"),__vite__mapDeps([16,3,1,2,4,12]));if(!navigator.usb)throw new Error("WebUSB not available: use Chrome/Edge over HTTPS or localhost");const b=new e.AdbWebUsbBackend,A=[{vendorId:6353},{vendorId:1256},{vendorId:4817},{vendorId:10007},{vendorId:10864},{vendorId:8921},{vendorId:11669}];let s;try{s=await b.requestDevice({filters:A})}catch(r){if((r==null?void 0:r.name)==="NotFoundError")o("No matching Android device found with filters, showing all devices...","info"),s=await b.requestDevice({filters:[]});else throw r}if(!s)throw new Error("No device selected");const p=await s.connect(),d=new i.Adb(p);typeof d.connect=="function"&&await d.connect(),o("Starting scrcpy server on device...","info");const D=c.AdbScrcpyOptions2_1??c.AdbScrcpyOptions1_24,y=new D({video:{codec:"h264",maxSize:1080,bitRate:8e6,tunnel:"adb"},audio:!1,tunnelForward:!0});let t;try{t=await c.AdbScrcpyClient.start(d,g.DefaultServerPath,y)}catch{const v=new c.AdbScrcpyClient(d,y);try{t={streams:await v.start()}}catch(h){throw o("ADB unauthorized or scrcpy server failed to start. Please accept USB debugging dialog on device and try again.","error"),h}}if((w=t==null?void 0:t.output)!=null&&w.pipeTo&&(a!=null&&a.WritableStream))try{await t.output.pipeTo(new a.WritableStream({write(r){const v=typeof r=="string"?r:(()=>{try{return new TextDecoder().decode(r)}catch{return String(r)}})();o(`scrcpy: ${v}`,"info")}}))}catch{}const u=new E.ScrcpyDecoderWebCodecs({canvas:S}),f=t.videoStream??((_=t.streams)==null?void 0:_.video)??t.streams??t;if(!f)throw new Error("No video stream from scrcpy");o("Decoding H.264 stream via WebCodecs...","info"),typeof u.decode=="function"?u.decode(f):typeof u.render=="function"&&u.render(f),l=async()=>{try{typeof t.close=="function"&&await t.close(),typeof p.close=="function"&&await p.close()}catch{}},o("USB mirror started","success")}catch(e){console.error(e);let i="";(e==null?void 0:e.name)==="SecurityError"&&(i="SecurityError: use HTTPS (GitHub Pages) or localhost, and enable USB debugging."),(e==null?void 0:e.name)==="NotFoundError"&&(i="No device selected or no matching device; ensure phone is connected and unlocked."),(m=e==null?void 0:e.message)!=null&&m.includes("unauthorized")&&(i="Device unauthorized: accept the USB debugging prompt and check Developer options.");const c=JSON.stringify({name:e==null?void 0:e.name,message:e==null?void 0:e.message,stack:e==null?void 0:e.stack},null,2);throw o(`USB mirror failed: ${(e==null?void 0:e.message)||e}${i?" | "+i:""}
${c}`,"error"),e}return{stop:async()=>{l&&await l(),o("USB mirror stopped","info")}}}export{T as startUsbMirror};

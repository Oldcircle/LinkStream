var x=r=>{throw TypeError(r)};var A=(r,e,i)=>e.has(r)||x("Cannot "+i);var t=(r,e,i)=>(A(r,e,"read from private field"),i?i.call(r):e.get(r)),o=(r,e,i)=>e.has(r)?x("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,i),h=(r,e,i,s)=>(A(r,e,"write to private field"),s?s.call(r,i):e.set(r,i),i);import{P as B,W as R,R as U,T as E}from"./stream-BT4ImN5b.js";import{E as O,C as S}from"./struct-deserialize-bkGssrR1.js";var y,f,q,w,v;class H{constructor(){o(this,y,"");o(this,f,new B);o(this,q,new R({write:e=>{h(this,y,t(this,y)+e)},close:()=>{t(this,f).resolve(t(this,y)),t(this,w).enqueue(t(this,y)),t(this,w).close()},abort:e=>{t(this,f).reject(e),t(this,w).error(e)}}));o(this,w);o(this,v,new U({start:e=>{h(this,w,e)}}));Object.defineProperties(t(this,v),{then:{get:()=>t(this,f).promise.then.bind(t(this,f).promise)},catch:{get:()=>t(this,f).promise.catch.bind(t(this,f).promise)},finally:{get:()=>t(this,f).promise.finally.bind(t(this,f).promise)}})}get writable(){return t(this,q)}get readable(){return t(this,v)}}y=new WeakMap,f=new WeakMap,q=new WeakMap,w=new WeakMap,v=new WeakMap;var p,c,M,g,W;class I{constructor(){o(this,p,[]);o(this,c,new B);o(this,M,new R({write:e=>{t(this,p).push(e)},close:()=>{let e,i=0;switch(t(this,p).length){case 0:e=O;break;case 1:e=t(this,p)[0];break;default:e=new Uint8Array(t(this,p).reduce((s,a)=>s+a.length,0));for(const s of t(this,p))e.set(s,i),i+=s.length;break}t(this,c).resolve(e),t(this,g).enqueue(e),t(this,g).close()},abort:e=>{t(this,c).reject(e),t(this,g).error(e)}}));o(this,g);o(this,W,new U({start:e=>{h(this,g,e)}}));Object.defineProperties(t(this,W),{then:{get:()=>t(this,c).promise.then.bind(t(this,c).promise)},catch:{get:()=>t(this,c).promise.catch.bind(t(this,c).promise)},finally:{get:()=>t(this,c).promise.finally.bind(t(this,c).promise)}})}get writable(){return t(this,M)}get readable(){return t(this,W)}}p=new WeakMap,c=new WeakMap,M=new WeakMap,g=new WeakMap,W=new WeakMap;function J(r){return r instanceof S?r.value:r}function D(r,e){return r instanceof S?r.tryConsume(e):e(r)}class K extends R{constructor(e,i){let s;i&&(s={},"highWaterMark"in i&&(s.highWaterMark=i.highWaterMark),"size"in i&&(s.size=a=>i.size(a instanceof S?a.value:a))),super({start(a){var l;return(l=e.start)==null?void 0:l.call(e,a)},write(a,l){return D(a,C=>{var d;return(d=e.write)==null?void 0:d.call(e,C,l)})},abort(a){var l;return(l=e.abort)==null?void 0:l.call(e,a)},close(){var a;return(a=e.close)==null?void 0:a.call(e)}},s)}}var b,m,n,u;class T{constructor(e){o(this,b);o(this,m);o(this,n);o(this,u);h(this,b,e),h(this,m,new Uint8Array(e)),h(this,n,0),h(this,u,e)}*push(e){let i=0,s=e.length;if(t(this,n)!==0)if(s>=t(this,u)){if(t(this,m).set(e.subarray(0,t(this,u)),t(this,n)),i+=t(this,u),s-=t(this,u),yield t(this,m),h(this,n,0),h(this,u,t(this,b)),s===0)return}else{t(this,m).set(e,t(this,n)),h(this,n,t(this,n)+s),h(this,u,t(this,u)-s);return}for(;s>=t(this,b);){const a=i+t(this,b);yield e.subarray(i,a),i=a,s-=t(this,b)}s>0&&(t(this,m).set(e.subarray(i),t(this,n)),h(this,n,t(this,n)+s),h(this,u,t(this,u)-s))}flush(){if(t(this,n)===0)return;const e=t(this,m).subarray(0,t(this,n));return h(this,n,0),h(this,u,t(this,b)),e}}b=new WeakMap,m=new WeakMap,n=new WeakMap,u=new WeakMap;class L extends E{constructor(e,i=!1){const s=i?new T(e):void 0;super({async transform(a,l){await D(a,async C=>{if(s)for(const d of s.push(C))await S.ReadableStream.enqueue(l,d);else{let d=0,j=C.length;for(;j>0;){const P=d+e;await S.ReadableStream.enqueue(l,C.subarray(d,P)),d=P,j-=e}}})},flush(a){if(s){const l=s.flush();l&&a.enqueue(l)}}})}}export{T as B,I as C,L as D,K as M,H as a,J as g,D as t};

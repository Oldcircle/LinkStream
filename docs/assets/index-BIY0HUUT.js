var Nt=Object.defineProperty;var Et=o=>{throw TypeError(o)};var kt=(o,t,r)=>t in o?Nt(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r;var ne=(o,t,r)=>kt(o,typeof t!="symbol"?t+"":t,r),tt=(o,t,r)=>t.has(o)||Et("Cannot "+r);var n=(o,t,r)=>(tt(o,t,"read from private field"),r?r.call(o):t.get(o)),s=(o,t,r)=>t.has(o)?Et("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(o):t.set(o,r),c=(o,t,r,a)=>(tt(o,t,"write to private field"),a?a.call(o,r):t.set(o,r),r),$=(o,t,r)=>(tt(o,t,"access private method"),r);import{A as Ve,h as Lt,a as Ot,S as rt,f as qt,e as Vt}from"./h265-BZeEvzU-.js";import{g as zt}from"./uint32-BfumdTHg.js";import{S as Ft,A as jt,E as $t}from"./sticky-event-emitter-B3ySTSV4.js";import{W as It,P as Xt}from"./stream-BT4ImN5b.js";import{g as Bt}from"./index--RZXy6Ug.js";function gt(o){return o.toString(16).toUpperCase()}function it(o){return o.toString(16).toUpperCase().padStart(2,"0")}function pe(o){return o.toString(10).padStart(2,"0")}var se,ge,$e,Yt;class Kt{constructor(t,r){s(this,$e);s(this,se);s(this,ge);c(this,se,t),c(this,ge,r)}decode(t){t.type!=="configuration"&&($(this,$e,Yt).call(this,t.data),n(this,se).decode(new EncodedVideoChunk({type:t.keyframe===!1?"delta":"key",timestamp:0,data:t.data})))}}se=new WeakMap,ge=new WeakMap,$e=new WeakSet,Yt=function(t){const a=new Ve(t).searchSequenceHeaderObu();if(!a)return;const{seq_profile:i,seq_level_idx:[e=0],max_frame_width_minus_1:f,max_frame_height_minus_1:u,color_config:{BitDepth:p,mono_chrome:g,subsampling_x:T,subsampling_y:E,chroma_sample_position:_,color_description_present_flag:m}}=a;let R,v,w,L;m?{color_primaries:R,transfer_characteristics:v,matrix_coefficients:w,color_range:L}=a.color_config:(R=Ve.ColorPrimaries.Bt709,v=Ve.TransferCharacteristics.Bt709,w=Ve.MatrixCoefficients.Bt709,L=!1);const G=f+1,F=u+1;n(this,ge).call(this,G,F);const D=["av01",i.toString(16),pe(e)+(a.seq_tier[0]?"H":"M"),pe(p),g?"1":"0",(T?"1":"0")+(E?"1":"0")+_.toString(),pe(R),pe(v),pe(w),L?"1":"0"].join(".");n(this,se).configure({codec:D,optimizeForLatency:!0})};var N,ve;class Wt{constructor(t){s(this,N);s(this,ve);c(this,ve,t)}decode(t){if(t.type==="configuration"){c(this,N,t.data),this.configure(t.data);return}let r;n(this,N)!==void 0?(r=new Uint8Array(n(this,N).length+t.data.length),r.set(n(this,N),0),r.set(t.data,n(this,N).length),c(this,N,void 0)):r=t.data,n(this,ve).decode(new EncodedVideoChunk({type:t.keyframe===!1?"delta":"key",timestamp:0,data:r}))}}N=new WeakMap,ve=new WeakMap;var Re,xe;class Jt extends Wt{constructor(r,a){super(r);s(this,Re);s(this,xe);c(this,Re,r),c(this,xe,a)}configure(r){const{profileIndex:a,constraintSet:i,levelIndex:e,croppedWidth:f,croppedHeight:u}=Lt(r);n(this,xe).call(this,f,u);const p="avc1."+it(a)+it(i)+it(e);n(this,Re).configure({codec:p,optimizeForLatency:!0})}}Re=new WeakMap,xe=new WeakMap;var _e,Ae;class Qt extends Wt{constructor(r,a){super(r);s(this,_e);s(this,Ae);c(this,_e,r),c(this,Ae,a)}configure(r){const{generalProfileSpace:a,generalProfileIndex:i,generalProfileCompatibilitySet:e,generalTierFlag:f,generalLevelIndex:u,generalConstraintSet:p,croppedWidth:g,croppedHeight:T}=Ot(r);n(this,Ae).call(this,g,T);const E=["hev1",["","A","B","C"][a]+i.toString(),gt(zt(e,0)),(f?"H":"L")+u.toString(),...Array.from(p,gt)].join(".");n(this,_e).configure({codec:E,codedWidth:g,codedHeight:T,optimizeForLatency:!0})}}_e=new WeakMap,Ae=new WeakMap;var Pe,Ke,Je,we,be,ye;class Zt{constructor(t,r){s(this,Pe);s(this,Ke,new ReadableStream({start:t=>{c(this,Pe,t)},pull:t=>{t.enqueue(n(this,we).call(this))}},{highWaterMark:0}));s(this,Je,n(this,Ke).getReader());s(this,we);s(this,be,0);s(this,ye);c(this,we,t),c(this,ye,r)}async borrow(){return(await n(this,Je).read()).value}return(t){n(this,be)<n(this,ye)&&(n(this,Pe).enqueue(t),c(this,be,n(this,be)+1))}}Pe=new WeakMap,Ke=new WeakMap,Je=new WeakMap,we=new WeakMap,be=new WeakMap,ye=new WeakMap;var C,Se;class er{constructor(){s(this,C);s(this,Se);typeof OffscreenCanvas<"u"?c(this,C,new OffscreenCanvas(1,1)):(c(this,C,document.createElement("canvas")),n(this,C).width=1,n(this,C).height=1),c(this,Se,n(this,C).getContext("bitmaprenderer",{alpha:!1}))}async capture(t){n(this,C).width=t.displayWidth,n(this,C).height=t.displayHeight;const r=await createImageBitmap(t);return n(this,Se).transferFromImageBitmap(r),n(this,C)instanceof OffscreenCanvas?await n(this,C).convertToBlob({type:"image/png"}):new Promise((a,i)=>{n(this,C).toBlob(e=>{e?a(e):i(new Error("Failed to convert canvas to blob"))},"image/png")})}}C=new WeakMap,Se=new WeakMap;const vt=new Zt(()=>new er,4);var K,J,Ce,ce,he,Q,Z,De,ue,Ue,Le,Fe,k,de,Y,ee,Ie,V,ft,mt,te,Xe;class tr{constructor({codec:t,renderer:r}){s(this,V);s(this,K);s(this,J);s(this,Ce);s(this,ce);s(this,he);s(this,Q);s(this,Z,0);s(this,De,0);s(this,ue,0);s(this,Ue,new Ft);s(this,Le,0);s(this,Fe,0);s(this,k);s(this,de,!1);s(this,Y);s(this,ee);s(this,Ie,0);s(this,te,(t,r)=>{n(this,Q).setSize(t,r),c(this,Le,t),c(this,Fe,r),n(this,Ue).fire({width:t,height:r})});s(this,Xe,()=>{n(this,Z)>0&&(c(this,De,n(this,De)+1),c(this,ue,n(this,ue)+(n(this,Z)-1)),c(this,Z,0)),c(this,Ie,requestAnimationFrame(n(this,Xe)))});switch(c(this,K,t),c(this,Q,r),c(this,k,new VideoDecoder({output:a=>{var i;if((i=n(this,ee))==null||i.close(),c(this,ee,a.clone()),n(this,de)){n(this,Y)&&(n(this,Y).close(),c(this,ue,n(this,ue)+1)),c(this,Y,a);return}$(this,V,mt).call(this,a)},error:a=>{$(this,V,ft).call(this,a)}})),n(this,K)){case rt.H264:c(this,J,new Jt(n(this,k),n(this,te)));break;case rt.H265:c(this,J,new Qt(n(this,k),n(this,te)));break;case rt.AV1:c(this,J,new Kt(n(this,k),n(this,te)));break;default:throw new Error(`Unsupported codec: ${n(this,K)}`)}c(this,Ce,new It({start:a=>{n(this,ce)?a.error(n(this,ce)):c(this,he,a)},write:a=>{n(this,J).decode(a)}})),n(this,Xe).call(this)}static get isSupported(){return typeof globalThis.VideoDecoder<"u"}get codec(){return n(this,K)}get writable(){return n(this,Ce)}get renderer(){return n(this,Q)}get framesRendered(){return n(this,De)}get framesSkipped(){return n(this,ue)}get sizeChanged(){return n(this,Ue).event}get width(){return n(this,Le)}get height(){return n(this,Fe)}async snapshot(){const t=n(this,ee);if(!t)return;const r=await vt.borrow(),a=await r.capture(t);return vt.return(r),a}dispose(){var t,r;cancelAnimationFrame(n(this,Ie)),n(this,k).state!=="closed"&&n(this,k).close(),(t=n(this,Y))==null||t.close(),(r=n(this,ee))==null||r.close()}}K=new WeakMap,J=new WeakMap,Ce=new WeakMap,ce=new WeakMap,he=new WeakMap,Q=new WeakMap,Z=new WeakMap,De=new WeakMap,ue=new WeakMap,Ue=new WeakMap,Le=new WeakMap,Fe=new WeakMap,k=new WeakMap,de=new WeakMap,Y=new WeakMap,ee=new WeakMap,Ie=new WeakMap,V=new WeakSet,ft=function(t){if(n(this,he))try{n(this,he).error(t)}catch{}else c(this,ce,t)},mt=async function(t){try{if(c(this,de,!0),n(this,te).call(this,t.displayWidth,t.displayHeight),await n(this,Q).draw(t),c(this,Z,n(this,Z)+1),t.close(),n(this,Y)){const r=n(this,Y);c(this,Y,void 0),await $(this,V,mt).call(this,r)}c(this,de,!1)}catch(r){$(this,V,ft).call(this,r)}},te=new WeakMap,Xe=new WeakMap,ne(tr,"capabilities",{h264:{},h265:{},av1:{}});var at,Rt;function rr(){if(Rt)return at;Rt=1;var o={validateDimension:function(t){if(t<=0||t!==(t|0))throw"YUV plane dimensions must be a positive integer"},validateOffset:function(t){if(t<0||t!==(t|0))throw"YUV plane offsets must be a non-negative integer"},format:function(t){var r=t.width,a=t.height,i=t.chromaWidth||r,e=t.chromaHeight||a,f=t.cropLeft||0,u=t.cropTop||0,p=t.cropWidth||r-f,g=t.cropHeight||a-u,T=t.displayWidth||p,E=t.displayHeight||g;return this.validateDimension(r),this.validateDimension(a),this.validateDimension(i),this.validateDimension(e),this.validateOffset(f),this.validateOffset(u),this.validateDimension(p),this.validateDimension(g),this.validateDimension(T),this.validateDimension(E),{width:r,height:a,chromaWidth:i,chromaHeight:e,cropLeft:f,cropTop:u,cropWidth:p,cropHeight:g,displayWidth:T,displayHeight:E}},suitableStride:function(t){o.validateDimension(t);var r=4,a=t%r;return a==0?t:t+(r-a)},allocPlane:function(t,r,a,i,e){var f,u;if(this.validateDimension(t),this.validateDimension(r),e=e||0,i=i||this.suitableStride(t),this.validateDimension(i),i<t)throw"Invalid input stride for YUV plane; must be larger than width";if(f=i*r,a){if(a.length-e<f)throw"Invalid input buffer for YUV plane; must be large enough for stride times height";u=a.slice(e,e+f)}else u=new Uint8Array(f),i=i||this.suitableStride(t);return{bytes:u,stride:i}},lumaPlane:function(t,r,a,i){return this.allocPlane(t.width,t.height,r,a,i)},chromaPlane:function(t,r,a,i){return this.allocPlane(t.chromaWidth,t.chromaHeight,r,a,i)},frame:function(t,r,a,i){return r=r||this.lumaPlane(t),a=a||this.chromaPlane(t),i=i||this.chromaPlane(t),{format:t,y:r,u:a,v:i}},copyPlane:function(t){return{bytes:t.bytes.slice(),stride:t.stride}},copyFrame:function(t){return{format:t.format,y:this.copyPlane(t.y),u:this.copyPlane(t.u),v:this.copyPlane(t.v)}},transferables:function(t){return[t.y.bytes.buffer,t.u.bytes.buffer,t.v.bytes.buffer]}};return at=o,at}var ir=rr();const Te=Bt(ir);var nt={exports:{}},ot={exports:{}},xt;function Tt(){return xt||(xt=1,(function(){function o(t,r){throw new Error("abstract")}o.prototype.drawFrame=function(t){throw new Error("abstract")},o.prototype.clear=function(){throw new Error("abstract")},ot.exports=o})()),ot.exports}var st={exports:{}},ct={exports:{}},ht={exports:{}},_t;function ar(){return _t||(_t=1,(function(){/**
 * Convert a ratio into a bit-shift count; for instance a ratio of 2
 * becomes a bit-shift of 1, while a ratio of 1 is a bit-shift of 0.
 *
 * @author Brooke Vibber <bvibber@pobox.com>
 * @copyright 2016-2024
 * @license MIT-style
 *
 * @param {number} ratio - the integer ratio to convert.
 * @returns {number} - number of bits to shift to multiply/divide by the ratio.
 * @throws exception if given a non-power-of-two
 */function o(t){for(var r=0,a=t>>1;a!=0;)a=a>>1,r++;if(t!==1<<r)throw"chroma plane dimensions must be power of 2 ratio to luma plane dimensions; got "+t;return r}ht.exports=o})()),ht.exports}var At;function nr(){return At||(At=1,(function(){var o=ar();/**
 * Basic YCbCr->RGB conversion
 *
 * @author Brooke Vibber <bvibber@pobox.com>
 * @copyright 2014-2024
 * @license MIT-style
 *
 * @param {YUVFrame} buffer - input frame buffer
 * @param {Uint8ClampedArray} output - array to draw RGBA into
 * Assumes that the output array already has alpha channel set to opaque.
 */function t(r,a){var i=r.format.width|0,e=r.format.height|0,f=o(r.format.width/r.format.chromaWidth)|0,u=o(r.format.height/r.format.chromaHeight)|0,p=r.y.bytes,g=r.u.bytes,T=r.v.bytes,E=r.y.stride|0,_=r.u.stride|0,m=r.v.stride|0,R=i<<2,v=0,w=0,L=0,G=0,F=0,D=0,S=0,b=0,I=0,X=0,x=0,U=0,H=0,B=0,M=0,h=0,d=0,l=0;if(f==1&&u==1)for(S=0,b=R,l=0,h=0;h<e;h+=2){for(w=h*E|0,L=w+E|0,G=l*_|0,F=l*m|0,M=0;M<i;M+=2)I=g[G++]|0,X=T[F++]|0,U=(409*X|0)-57088|0,H=(100*I|0)+(208*X|0)-34816|0,B=(516*I|0)-70912|0,x=298*p[w++]|0,a[S]=x+U>>8,a[S+1]=x-H>>8,a[S+2]=x+B>>8,S+=4,x=298*p[w++]|0,a[S]=x+U>>8,a[S+1]=x-H>>8,a[S+2]=x+B>>8,S+=4,x=298*p[L++]|0,a[b]=x+U>>8,a[b+1]=x-H>>8,a[b+2]=x+B>>8,b+=4,x=298*p[L++]|0,a[b]=x+U>>8,a[b+1]=x-H>>8,a[b+2]=x+B>>8,b+=4;S+=R,b+=R,l++}else for(D=0,h=0;h<e;h++)for(d=0,l=h>>u,v=h*E|0,G=l*_|0,F=l*m|0,M=0;M<i;M++)d=M>>f,I=g[G+d]|0,X=T[F+d]|0,U=(409*X|0)-57088|0,H=(100*I|0)+(208*X|0)-34816|0,B=(516*I|0)-70912|0,x=298*p[v++]|0,a[D]=x+U>>8,a[D+1]=x-H>>8,a[D+2]=x+B>>8,D+=4}ct.exports={convertYCbCr:t}})()),ct.exports}var Pt;function or(){return Pt||(Pt=1,(function(){var o=Tt(),t=nr();function r(a){var i=this,e=a.getContext("2d"),f=null,u=null,p=null;function g(E,_){f=e.createImageData(E,_);for(var m=f.data,R=E*_*4,v=0;v<R;v+=4)m[v+3]=255}function T(E,_){u=document.createElement("canvas"),u.width=E,u.height=_,p=u.getContext("2d")}return i.drawFrame=function(_){var m=_.format;(a.width!==m.displayWidth||a.height!==m.displayHeight)&&(a.width=m.displayWidth,a.height=m.displayHeight),(f===null||f.width!=m.width||f.height!=m.height)&&g(m.width,m.height),t.convertYCbCr(_,f.data);var R=m.cropWidth!=m.displayWidth||m.cropHeight!=m.displayHeight,v;R?(u||T(m.cropWidth,m.cropHeight),v=p):v=e,v.putImageData(f,-m.cropLeft,-m.cropTop,m.cropLeft,m.cropTop,m.cropWidth,m.cropHeight),R&&e.drawImage(u,0,0,m.displayWidth,m.displayHeight)},i.clear=function(){e.clearRect(0,0,a.width,a.height)},i}r.prototype=Object.create(o.prototype),st.exports=r})()),st.exports}var ut={exports:{}},dt,wt;function sr(){return wt||(wt=1,dt={vertex:`precision mediump float;

attribute vec2 aPosition;
attribute vec2 aLumaPosition;
attribute vec2 aChromaPosition;
varying vec2 vLumaPosition;
varying vec2 vChromaPosition;
void main() {
    gl_Position = vec4(aPosition, 0, 1);
    vLumaPosition = aLumaPosition;
    vChromaPosition = aChromaPosition;
}
`,fragment:`// inspired by https://github.com/mbebenita/Broadway/blob/master/Player/canvas.js

precision mediump float;

uniform sampler2D uTextureY;
uniform sampler2D uTextureCb;
uniform sampler2D uTextureCr;
varying vec2 vLumaPosition;
varying vec2 vChromaPosition;
void main() {
   // Y, Cb, and Cr planes are uploaded as ALPHA textures.
   float fY = texture2D(uTextureY, vLumaPosition).w;
   float fCb = texture2D(uTextureCb, vChromaPosition).w;
   float fCr = texture2D(uTextureCr, vChromaPosition).w;

   // Premultipy the Y...
   float fYmul = fY * 1.1643828125;

   // And convert that to RGB!
   gl_FragColor = vec4(
     fYmul + 1.59602734375 * fCr - 0.87078515625,
     fYmul - 0.39176171875 * fCb - 0.81296875 * fCr + 0.52959375,
     fYmul + 2.017234375   * fCb - 1.081390625,
     1
   );
}
`,vertexStripe:`precision mediump float;

attribute vec2 aPosition;
attribute vec2 aTexturePosition;
varying vec2 vTexturePosition;

void main() {
    gl_Position = vec4(aPosition, 0, 1);
    vTexturePosition = aTexturePosition;
}
`,fragmentStripe:`// extra 'stripe' texture fiddling to work around IE 11's poor performance on gl.LUMINANCE and gl.ALPHA textures

precision mediump float;

uniform sampler2D uStripe;
uniform sampler2D uTexture;
varying vec2 vTexturePosition;
void main() {
   // Y, Cb, and Cr planes are mapped into a pseudo-RGBA texture
   // so we can upload them without expanding the bytes on IE 11
   // which doesn't allow LUMINANCE or ALPHA textures
   // The stripe textures mark which channel to keep for each pixel.
   // Each texture extraction will contain the relevant value in one
   // channel only.

   float fLuminance = dot(
      texture2D(uStripe, vTexturePosition),
      texture2D(uTexture, vTexturePosition)
   );

   gl_FragColor = vec4(0, 0, 0, fLuminance);
}
`}),dt}var bt;function cr(){return bt||(bt=1,(function(){var o=Tt(),t=sr();function r(a){var i=this,e=r.contextForCanvas(a);if(e===null)throw new Error("WebGL unavailable");function f(h,d){var l=e.createShader(h);if(e.shaderSource(l,d),e.compileShader(l),!e.getShaderParameter(l,e.COMPILE_STATUS)){var A=e.getShaderInfoLog(l);throw e.deleteShader(l),new Error("GL shader compilation for "+h+" failed: "+A)}return l}var u,p,g=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),T={},E={},_={},m,R,v,w,L,G,F,D,S,b;function I(h,d){return(!T[h]||d)&&(T[h]=e.createTexture()),T[h]}function X(h,d,l,A,P){var q=!T[h]||d,ie=I(h,d);if(e.activeTexture(e.TEXTURE0),r.stripe){var z=!T[h+"_temp"]||d,me=I(h+"_temp",d);e.bindTexture(e.TEXTURE_2D,me),z?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,l/4,A,0,e.RGBA,e.UNSIGNED_BYTE,P)):e.texSubImage2D(e.TEXTURE_2D,0,0,0,l/4,A,e.RGBA,e.UNSIGNED_BYTE,P);var j=T[h+"_stripe"],ae=!j||d;ae&&(j=I(h+"_stripe",d)),e.bindTexture(e.TEXTURE_2D,j),ae&&(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,l,1,0,e.RGBA,e.UNSIGNED_BYTE,H(l)))}else e.bindTexture(e.TEXTURE_2D,ie),q?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texImage2D(e.TEXTURE_2D,0,e.ALPHA,l,A,0,e.ALPHA,e.UNSIGNED_BYTE,P)):e.texSubImage2D(e.TEXTURE_2D,0,0,0,l,A,e.ALPHA,e.UNSIGNED_BYTE,P)}function x(h,d,l,A){var P=T[h];e.useProgram(p);var q=E[h];(!q||d)&&(e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,P),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,l,A,0,e.RGBA,e.UNSIGNED_BYTE,null),q=E[h]=e.createFramebuffer()),e.bindFramebuffer(e.FRAMEBUFFER,q),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,P,0);var ie=T[h+"_temp"];e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,ie),e.uniform1i(G,1);var z=T[h+"_stripe"];e.activeTexture(e.TEXTURE2),e.bindTexture(e.TEXTURE_2D,z),e.uniform1i(L,2),e.bindBuffer(e.ARRAY_BUFFER,m),e.enableVertexAttribArray(R),e.vertexAttribPointer(R,2,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,v),e.enableVertexAttribArray(w),e.vertexAttribPointer(w,2,e.FLOAT,!1,0,0),e.viewport(0,0,l,A),e.drawArrays(e.TRIANGLES,0,g.length/2),e.bindFramebuffer(e.FRAMEBUFFER,null)}function U(h,d,l){e.activeTexture(d),e.bindTexture(e.TEXTURE_2D,T[h]),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.uniform1i(e.getUniformLocation(u,h),l)}function H(h){if(_[h])return _[h];for(var d=h,l=new Uint32Array(d),A=0;A<d;A+=4)l[A]=255,l[A+1]=65280,l[A+2]=16711680,l[A+3]=4278190080;return _[h]=new Uint8Array(l.buffer)}function B(h,d){var l=f(e.VERTEX_SHADER,h),A=f(e.FRAGMENT_SHADER,d),P=e.createProgram();if(e.attachShader(P,l),e.attachShader(P,A),e.linkProgram(P),!e.getProgramParameter(P,e.LINK_STATUS)){var q=e.getProgramInfoLog(P);throw e.deleteProgram(P),new Error("GL program linking failed: "+q)}return P}function M(){if(r.stripe){p=B(t.vertexStripe,t.fragmentStripe),e.getAttribLocation(p,"aPosition"),v=e.createBuffer();var h=new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]);e.bindBuffer(e.ARRAY_BUFFER,v),e.bufferData(e.ARRAY_BUFFER,h,e.STATIC_DRAW),w=e.getAttribLocation(p,"aTexturePosition"),L=e.getUniformLocation(p,"uStripe"),G=e.getUniformLocation(p,"uTexture")}u=B(t.vertex,t.fragment),m=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,m),e.bufferData(e.ARRAY_BUFFER,g,e.STATIC_DRAW),R=e.getAttribLocation(u,"aPosition"),F=e.createBuffer(),D=e.getAttribLocation(u,"aLumaPosition"),S=e.createBuffer(),b=e.getAttribLocation(u,"aChromaPosition")}return i.drawFrame=function(h){var d=h.format,l=!u||a.width!==d.displayWidth||a.height!==d.displayHeight;if(l&&(a.width=d.displayWidth,a.height=d.displayHeight,i.clear()),u||M(),l){var A=function(P,q,ie){var z=d.cropLeft/ie,me=(d.cropLeft+d.cropWidth)/ie,j=(d.cropTop+d.cropHeight)/d.height,ae=d.cropTop/d.height,Mt=new Float32Array([z,j,me,j,z,ae,z,ae,me,j,me,ae]);e.bindBuffer(e.ARRAY_BUFFER,P),e.bufferData(e.ARRAY_BUFFER,Mt,e.STATIC_DRAW)};A(F,D,h.y.stride),A(S,b,h.u.stride*d.width/d.chromaWidth)}X("uTextureY",l,h.y.stride,d.height,h.y.bytes),X("uTextureCb",l,h.u.stride,d.chromaHeight,h.u.bytes),X("uTextureCr",l,h.v.stride,d.chromaHeight,h.v.bytes),r.stripe&&(x("uTextureY",l,h.y.stride,d.height),x("uTextureCb",l,h.u.stride,d.chromaHeight),x("uTextureCr",l,h.v.stride,d.chromaHeight)),e.useProgram(u),e.viewport(0,0,a.width,a.height),U("uTextureY",e.TEXTURE0,0),U("uTextureCb",e.TEXTURE1,1),U("uTextureCr",e.TEXTURE2,2),e.bindBuffer(e.ARRAY_BUFFER,m),e.enableVertexAttribArray(R),e.vertexAttribPointer(R,2,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,F),e.enableVertexAttribArray(D),e.vertexAttribPointer(D,2,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,S),e.enableVertexAttribArray(b),e.vertexAttribPointer(b,2,e.FLOAT,!1,0,0),e.drawArrays(e.TRIANGLES,0,g.length/2)},i.clear=function(){e.viewport(0,0,a.width,a.height),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT)},i.clear(),i}r.stripe=!1,r.contextForCanvas=function(a){var i={preferLowPowerToHighPerformance:!0,powerPreference:"low-power",failIfMajorPerformanceCaveat:!0,preserveDrawingBuffer:!0};return a.getContext("webgl",i)||a.getContext("experimental-webgl",i)},r.isAvailable=function(){var a=document.createElement("canvas"),i;a.width=1,a.height=1;try{i=r.contextForCanvas(a)}catch{return!1}if(i){var e=i.TEXTURE0,f=4,u=4,p=i.createTexture(),g=new Uint8Array(f*u),T=r.stripe?f/4:f,E=r.stripe?i.RGBA:i.ALPHA,_=r.stripe?i.NEAREST:i.LINEAR;i.activeTexture(e),i.bindTexture(i.TEXTURE_2D,p),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,_),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,_),i.texImage2D(i.TEXTURE_2D,0,E,T,u,0,E,i.UNSIGNED_BYTE,g);var m=i.getError();return!m}else return!1},r.prototype=Object.create(o.prototype),ut.exports=r})()),ut.exports}var yt;function hr(){return yt||(yt=1,(function(){var o=Tt(),t=or(),r=cr(),a={FrameSink:o,SoftwareFrameSink:t,WebGLFrameSink:r,attach:function(i,e){e=e||{};var f="webGL"in e?e.webGL:r.isAvailable();return f?new r(i,e):new t(i,e)}};nt.exports=a})()),nt.exports}var ur=hr();const dr=Bt(ur);let Ee,St=!1;const lt=[];let ze=0;const pt=new Map;function lr(o,t){return pt.set(o,t),{dispose(){pt.delete(o)}}}var Be,Qe;class Ct extends jt{constructor(r){super();ne(this,"streamId");s(this,Be,new $t);s(this,Qe,r=>{n(this,Be).fire(r)});this.streamId=r,this.addDisposable(lr(r,n(this,Qe)))}get onPictureReady(){return n(this,Be).event}feed(r){Ee.postMessage({type:"decode",data:r,offset:0,length:r.byteLength,renderStateId:this.streamId},[r])}dispose(){super.dispose(),Ee.postMessage({type:"release",renderStateId:this.streamId})}}Be=new WeakMap,Qe=new WeakMap;function fr(){if(Ee||(Ee=new Worker(new URL("/LinkStream/assets/worker-D6BRitjy.js",import.meta.url),{type:"module"}),Ee.addEventListener("message",({data:t})=>{var r;switch(t.type){case"decoderReady":St=!0;for(const a of lt)a.resolve(new Ct(ze)),ze+=1;lt.length=0;break;case"pictureReady":(r=pt.get(t.renderStateId))==null||r(t);break}})),!St){const t=new Xt;return lt.push(t),t.promise}const o=new Ct(ze);return ze+=1,Promise.resolve(o)}const mr=()=>{};function je(){if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(1,1);throw new Error("no canvas input found nor any canvas can be created")}var re,Ye,We,Ge,He,Ze,Me,le,O,et,Gt;class pr{constructor({canvas:t}={}){s(this,et);s(this,re);s(this,Ye,new Ft);s(this,We,0);s(this,Ge,0);s(this,He,0);s(this,Ze,0);s(this,Me);s(this,le);s(this,O);t?c(this,re,t):c(this,re,je()),c(this,Me,new It({write:async r=>{switch(r.type){case"configuration":await $(this,et,Gt).call(this,r.data);break;case"data":{if(!n(this,O))throw new Error("Decoder not configured");(await n(this,O).promise).feed(r.data.slice().buffer);break}}}}))}get renderer(){return n(this,re)}get sizeChanged(){return n(this,Ye).event}get width(){return n(this,We)}get height(){return n(this,Ge)}get framesRendered(){return n(this,He)}get framesSkipped(){return n(this,Ze)}get writable(){return n(this,Me)}dispose(){var t;(t=n(this,O))==null||t.promise.then(r=>r.dispose()).catch(mr),c(this,O,void 0)}}re=new WeakMap,Ye=new WeakMap,We=new WeakMap,Ge=new WeakMap,He=new WeakMap,Ze=new WeakMap,Me=new WeakMap,le=new WeakMap,O=new WeakMap,et=new WeakSet,Gt=async function(t){if(this.dispose(),c(this,O,new Xt),!n(this,le)){const R=je(),v={failIfMajorPerformanceCaveat:!0},w=R.getContext("webgl2",v)||R.getContext("webgl",v);c(this,le,dr.attach(n(this,re),{webGL:!!w}))}const{encodedWidth:r,encodedHeight:a,croppedWidth:i,croppedHeight:e,cropLeft:f,cropTop:u}=Lt(t);c(this,We,i),c(this,Ge,e),n(this,Ye).fire({width:i,height:e});const p=r/2,g=a/2,T=Te.format({width:r,height:a,chromaWidth:p,chromaHeight:g,cropLeft:f,cropTop:u,cropWidth:i,cropHeight:e,displayWidth:i,displayHeight:e}),E=await fr();n(this,O).resolve(E);const _=r*a,m=_+p*g;E.onPictureReady(({data:R})=>{c(this,He,n(this,He)+1);const v=new Uint8Array(R),w=Te.frame(T,Te.lumaPlane(T,v,r,0),Te.chromaPlane(T,v,p,_),Te.chromaPlane(T,v,p,m));n(this,le).drawFrame(w)}),E.feed(t.slice().buffer)},ne(pr,"capabilities",{h264:{maxProfile:Vt.Baseline,maxLevel:qt.Level4}});var W;class Ht{constructor(t){s(this,W);t?c(this,W,t):c(this,W,je())}get canvas(){return n(this,W)}setSize(t,r){(n(this,W).width!==t||n(this,W).height!==r)&&(n(this,W).width=t,n(this,W).height=r)}}W=new WeakMap;var Ne;class Ar extends Ht{constructor(r){super(r);s(this,Ne);c(this,Ne,this.canvas.getContext("bitmaprenderer",{alpha:!1}))}async draw(r){const a=await createImageBitmap(r);n(this,Ne).transferFromImageBitmap(a)}}Ne=new WeakMap;var y,fe,ke,Oe;class Pr{constructor(t){s(this,y);s(this,fe);s(this,ke);s(this,Oe);if(t)c(this,y,t);else if(typeof document<"u")c(this,y,document.createElement("video"));else throw new Error("no video element input found nor any video element can be created");n(this,y).muted=!0,n(this,y).autoplay=!0,n(this,y).disablePictureInPicture=!0,n(this,y).disableRemotePlayback=!0,c(this,fe,new MediaStreamTrackGenerator({kind:"video"})),c(this,ke,n(this,fe).writable.getWriter()),c(this,Oe,new MediaStream([n(this,fe)])),n(this,y).srcObject=n(this,Oe)}static get isSupported(){return typeof MediaStreamTrackGenerator<"u"}get element(){return n(this,y)}setSize(t,r){(n(this,y).width!==t||n(this,y).height!==r)&&(n(this,y).width=t,n(this,y).height=r)}async draw(t){await n(this,ke).write(t)}}y=new WeakMap,fe=new WeakMap,ke=new WeakMap,Oe=new WeakMap;const Tr=Promise.resolve();function Dt(o,t){const r={powerPreference:"low-power",alpha:!1,failIfMajorPerformanceCaveat:!0,preserveDrawingBuffer:!!t};return o.getContext("webgl2",r)||o.getContext("webgl",r)}var qe;const oe=class oe extends Ht{constructor(r,a){super(r);s(this,qe);const i=Dt(this.canvas,a);if(!i)throw new Error("WebGL not supported");c(this,qe,i);const e=i.createShader(i.VERTEX_SHADER);if(i.shaderSource(e,oe.vertexShaderSource),i.compileShader(e),!i.getShaderParameter(e,i.COMPILE_STATUS))throw new Error(i.getShaderInfoLog(e));const f=i.createShader(i.FRAGMENT_SHADER);if(i.shaderSource(f,oe.fragmentShaderSource),i.compileShader(f),!i.getShaderParameter(f,i.COMPILE_STATUS))throw new Error(i.getShaderInfoLog(f));const u=i.createProgram();if(i.attachShader(u,e),i.attachShader(u,f),i.linkProgram(u),!i.getProgramParameter(u,i.LINK_STATUS))throw new Error(i.getProgramInfoLog(u));i.useProgram(u);const p=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,p),i.bufferData(i.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),i.STATIC_DRAW);const g=i.getAttribLocation(u,"xy");i.vertexAttribPointer(g,2,i.FLOAT,!1,0,0),i.enableVertexAttribArray(g);const T=i.createTexture();i.bindTexture(i.TEXTURE_2D,T),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE)}static get isSupported(){const r=je();return!!Dt(r)}draw(r){const a=n(this,qe);return a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,r),a.viewport(0,0,a.drawingBufferWidth,a.drawingBufferHeight),a.drawArrays(a.TRIANGLE_FAN,0,4),Tr}};qe=new WeakMap,ne(oe,"vertexShaderSource",`
        attribute vec2 xy;

        varying highp vec2 uv;

        void main(void) {
            gl_Position = vec4(xy, 0.0, 1.0);
            // Map vertex coordinates (-1 to +1) to UV coordinates (0 to 1).
            // UV coordinates are Y-flipped relative to vertex coordinates.
            uv = vec2((1.0 + xy.x) / 2.0, (1.0 - xy.y) / 2.0);
        }
`),ne(oe,"fragmentShaderSource",`
        varying highp vec2 uv;

        uniform sampler2D texture;

        void main(void) {
            gl_FragColor = texture2D(texture, uv);
        }
`);let Ut=oe;export{Kt as Av1Codec,Ar as BitmapVideoFrameRenderer,Ht as CanvasVideoFrameRenderer,Jt as H264Decoder,Qt as H265Decoder,Wt as H26xDecoder,Pr as InsertableStreamVideoFrameRenderer,tr as WebCodecsVideoDecoder,Ut as WebGLVideoFrameRenderer,pe as decimalTwoDigits,gt as hexDigits,it as hexTwoDigits};

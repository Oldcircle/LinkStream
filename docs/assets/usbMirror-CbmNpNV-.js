const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-V_WUKhLh.js","assets/stream-BT4ImN5b.js","assets/distribution-vvPj2d0I.js","assets/struct-deserialize-bkGssrR1.js","assets/encoding-D3q_jWej.js","assets/string-Gn2dS4oc.js","assets/uint32-BfumdTHg.js","assets/reverse-D3S_M3ap.js","assets/sticky-event-emitter-B3ySTSV4.js","assets/index-tKmTrm3T.js","assets/3_3_2-DmD8R-J5.js","assets/h265-BZeEvzU-.js","assets/split-string-NR4_hcTk.js","assets/index-CrHIl016.js","assets/index-4ChpbbW0.js","assets/index-9ZXIKo4S.js","assets/index-Di93NhIW.js"])))=>i.map(i=>d[i]);
import{_ as s}from"./index-9ZXIKo4S.js";async function T(W,i){var y,h,S,g,_,B,A,U;let v=null;try{i("Requesting Android device via WebUSB...","info");try{const r=window.isSecureContext,a=navigator.userAgent;i(`Env: secure=${r} ua=${a}`,"info");const u=await((h=(y=navigator.usb).getDevices)==null?void 0:h.call(y));u&&i(`Known USB devices: ${u.length}`,"info")}catch{}const e=await s(()=>import("./index-CwCV73Rw.js"),[]),c=await s(()=>import("./index-V_WUKhLh.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8])),d=await s(()=>import("./index-tKmTrm3T.js"),__vite__mapDeps([9,10,3,1,5,6,11,12,8,7,4])),D=await s(()=>import("./index-CrHIl016.js"),__vite__mapDeps([13,10,3,1,5,6,11])),N=await s(()=>import("./index-4ChpbbW0.js"),__vite__mapDeps([14,11,6,8,1,15])),f=await s(()=>import("./index-Di93NhIW.js"),__vite__mapDeps([16,3,1,2,4,12]));if(!navigator.usb)throw new Error("WebUSB not available: use Chrome/Edge over HTTPS or localhost");const E=[{vendorId:6353},{vendorId:1256},{vendorId:4817},{vendorId:10007},{vendorId:10864},{vendorId:8921},{vendorId:11669}];let o;try{typeof((S=e.AdbWebUsbBackend)==null?void 0:S.requestDevice)=="function"?o=await e.AdbWebUsbBackend.requestDevice({filters:E}):o=await navigator.usb.requestDevice({filters:E})}catch(r){if((r==null?void 0:r.name)==="NotFoundError")i("No matching Android device found with filters, showing all devices...","info"),typeof((g=e.AdbWebUsbBackend)==null?void 0:g.requestDevice)=="function"?o=await e.AdbWebUsbBackend.requestDevice({filters:[]}):o=await navigator.usb.requestDevice({filters:[]});else throw r}if(!o)throw new Error("No device selected");const t=(o==null?void 0:o.device)??o;try{const r={vendorId:t==null?void 0:t.vendorId,productId:t==null?void 0:t.productId,productName:t==null?void 0:t.productName,manufacturerName:t==null?void 0:t.manufacturerName,serialNumber:t==null?void 0:t.serialNumber};i(`Selected device: ${JSON.stringify(r)}`,"info")}catch{}try{if(typeof t.open=="function"&&!t.opened&&await t.open(),typeof t.selectConfiguration=="function"&&t.configuration==null)try{await t.selectConfiguration(1)}catch{}}catch{}let w;if(typeof((_=e.AdbWebUsbBackend)==null?void 0:_.fromDevice)=="function")w=await e.AdbWebUsbBackend.fromDevice(t);else if(typeof e.AdbWebUsbBackend=="function")w=new e.AdbWebUsbBackend(t);else throw new Error("AdbWebUsbBackend not available");let l;try{l=await w.connect()}catch(r){const a=String((r==null?void 0:r.message)||"");throw a.includes("claimInterface")&&i("Unable to claim USB ADB interface. On Windows, install WinUSB driver for the ADB interface (use Zadig or Google USB Driver), close OEM phone suites (HiSuite/Kies), replug the device, and ensure USB debugging is enabled.","error"),a.includes("addEventListener")&&i("WebUSB backend initialization failed (addEventListener on undefined). Ensure latest Chrome/Edge is used and the backend received a USBDevice (not a wrapper). Replug the device and retry.","error"),r}const p=new c.Adb(l);typeof p.connect=="function"&&await p.connect(),i("Starting scrcpy server on device...","info");const O=d.AdbScrcpyOptions2_1??d.AdbScrcpyOptions1_24,I=new O({video:{codec:"h264",maxSize:1080,bitRate:8e6,tunnel:"adb"},audio:!1,tunnelForward:!0});try{i(`scrcpy options: ${JSON.stringify({codec:"h264",maxSize:1080,bitRate:8e6,audio:!1,tunnel:"adb",tunnelForward:!0})}`,"info")}catch{}let n;try{n=await d.AdbScrcpyClient.start(p,D.DefaultServerPath,I)}catch{const a=new d.AdbScrcpyClient(p,I);try{n={streams:await a.start()}}catch(u){throw i("ADB unauthorized or scrcpy server failed to start. Please accept USB debugging dialog on device and try again.","error"),u}}if((B=n==null?void 0:n.output)!=null&&B.pipeTo&&(f!=null&&f.WritableStream))try{await n.output.pipeTo(new f.WritableStream({write(r){const a=typeof r=="string"?r:(()=>{try{return new TextDecoder().decode(r)}catch{return String(r)}})();i(`scrcpy: ${a}`,"info")}}))}catch{}const b=new N.ScrcpyDecoderWebCodecs({canvas:W}),m=n.videoStream??((A=n.streams)==null?void 0:A.video)??n.streams??n;if(!m)throw new Error("No video stream from scrcpy");i("Decoding H.264 stream via WebCodecs...","info"),typeof b.decode=="function"?b.decode(m):typeof b.render=="function"&&b.render(m),v=async()=>{try{typeof n.close=="function"&&await n.close(),typeof l.close=="function"&&await l.close()}catch{}},i("USB mirror started","success")}catch(e){console.error(e);let c="";(e==null?void 0:e.name)==="SecurityError"&&(c="SecurityError: use HTTPS (GitHub Pages) or localhost, and enable USB debugging."),(e==null?void 0:e.name)==="NotFoundError"&&(c="No device selected or no matching device; ensure phone is connected and unlocked."),(U=e==null?void 0:e.message)!=null&&U.includes("unauthorized")&&(c="Device unauthorized: accept the USB debugging prompt and check Developer options.");const d=JSON.stringify({name:e==null?void 0:e.name,message:e==null?void 0:e.message,stack:e==null?void 0:e.stack},null,2);throw i(`USB mirror failed: ${(e==null?void 0:e.message)||e}${c?" | "+c:""}
${d}`,"error"),e}return{stop:async()=>{v&&await v(),i("USB mirror stopped","info")}}}export{T as startUsbMirror};

var Oe=Object.defineProperty;var He=t=>{throw TypeError(t)};var je=(t,e,i)=>e in t?Oe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var ne=(t,e,i)=>je(t,typeof e!="symbol"?e+"":e,i),we=(t,e,i)=>e.has(t)||He("Cannot "+i);var _=(t,e,i)=>(we(t,e,"read from private field"),i?i.call(t):e.get(t)),q=(t,e,i)=>e.has(t)?He("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,i),h=(t,e,i,n)=>(we(t,e,"write to private field"),n?n.call(t,i):e.set(t,i),i),z=(t,e,i)=>(we(t,e,"access private method"),i);const ke={H264:1748121140,H265:1748121141,AV1:6387249},rt=(()=>{const t=new Map;for(const e in ke){const i=ke[e];t.set(i,e)}return t})(),ct={Main8:1,Main10:2,Main10Hdr10:4096,Main10Hdr10Plus:8192},ft={Level2:1,Level21:2,Level22:4,Level23:8,Level3:16,Level31:32,Level32:64,Level33:128,Level4:256,Level41:512,Level42:1024,Level43:2048,Level5:4096,Level51:8192,Level52:16384,Level53:32768,Level6:65536,Level61:1<<17,Level62:1<<18,Level63:1<<19,Level7:1<<20,Level71:1<<21,Level72:1<<22,Level73:1<<23};var A,O,C,U;class De{constructor(e){q(this,A);q(this,O);q(this,C,0);q(this,U,7);h(this,A,e),h(this,O,e[0])}get byteAligned(){return _(this,U)===7}get ended(){return _(this,C)>=_(this,A).length}f1(){const e=_(this,O)>>_(this,U);return h(this,U,_(this,U)-1),_(this,U)<0&&(h(this,C,_(this,C)+1),h(this,U,7),h(this,O,_(this,A)[_(this,C)])),e&1}f(e){let i=0;for(;e>0;e-=1)i<<=1,i|=this.f1();return i}skip(e){if(e<=_(this,U)+1){h(this,C,_(this,C)+1),h(this,U,7),h(this,O,_(this,A)[_(this,C)]);return}e-=_(this,U)+1,h(this,C,_(this,C)+1);const i=e/8|0;i>0&&(h(this,C,_(this,C)+i),e-=i*8),h(this,U,7-e),h(this,O,_(this,A)[_(this,C)])}readBytes(e){if(!this.byteAligned)throw new Error("Bytes must be byte-aligned");const i=_(this,A).subarray(_(this,C),_(this,C)+e);return h(this,C,_(this,C)+e),h(this,O,_(this,A)[_(this,C)]),i}getPosition(){return[_(this,C),_(this,U)]}setPosition([e,i]){h(this,C,e),h(this,U,i),h(this,O,_(this,A)[e])}}A=new WeakMap,O=new WeakMap,C=new WeakMap,U=new WeakMap;const Fe={SequenceHeader:1,TemporalDelimiter:2,FrameHeader:3,TileGroup:4,Metadata:5,Frame:6,RedundantFrameHeader:7,TileList:8,Padding:15},We={Bt709:1,Unspecified:2,Bt470M:4,Bt470BG:5,Bt601:6,Smpte240:7,GenericFilm:8,Bt2020:9,Xyz:10,Smpte431:11,Smpte432:12,Ebu3213:22},Ve={Bt709:1,Unspecified:2,Bt470M:4,Bt470BG:5,Bt601:6,Smpte240:7,Linear:8,Log100:9,Log100Sqrt10:10,Iec61966:11,Bt1361:12,Srgb:13,Bt2020Ten:14,Bt2020Twelve:15,Smpte2084:16,Smpte428:17,Hlg:18},Ze={Identity:0,Bt709:1,Unspecified:2,Fcc:4,Bt470BG:5,Bt601:6,Smpte240:7,YCgCo:8,Bt2020Ncl:9,Bt2020Cl:10,Smpte2085:11,ChromatNcl:12,ChromatCl:13,ICtCp:14};var oe,se;const B=class B extends De{constructor(){super(...arguments);q(this,oe,0);q(this,se,0)}uvlc(){let i=0;for(;!this.f1();)i+=1;return i>=32?2**32-1:this.f(i)+(1<<i>>>0)-1}leb128(){if(!this.byteAligned)throw new Error("LEB128 must be byte-aligned");let i=0n;h(this,oe,0);for(let n=0n;n<8n;n+=1n){const o=this.f(8);if(i|=BigInt(o&127)<<7n*n,h(this,oe,_(this,oe)+1),(o&128)==0)break}return i}*annexBBitstream(){for(;!this.ended;){const i=this.leb128();yield*this.temporalUnit(i)}}*temporalUnit(i){for(;i>0;){const n=this.leb128();i-=BigInt(_(this,oe)),yield*this.frameUnit(n),i-=n}}*frameUnit(i){for(;i>0;){const n=this.leb128();i-=BigInt(_(this,oe));const o=this.openBitstreamUnit(n);o&&(yield o),i-=n}}openBitstreamUnit(i){const n=this.obuHeader();let o;if(n.obu_has_size_field)o=this.leb128();else if(i!==void 0)o=i-1n-(n.obu_extension_flag?1n:0n);else throw new Error("obu_has_size_field must be true");const s=this.getPosition();if(n.obu_type!==B.ObuType.SequenceHeader&&n.obu_type!==B.ObuType.TemporalDelimiter&&_(this,se)!==0&&n.obu_extension_header){const r=!!(_(this,se)&1<<n.obu_extension_header.temporal_id),y=!!(_(this,se)&1<<n.obu_extension_header.spatial_id+8);if(!r||!y){this.skip(Number(o));return}}let l;switch(n.obu_type){case B.ObuType.SequenceHeader:l=this.sequenceHeaderObu();break}const f=this.getPosition(),c=(f[0]-s[0])*8+(s[1]-f[1]);return o>0&&this.skip(Number(o)*8-c),{obu_header:n,obu_size:o,sequence_header_obu:l}}obuHeader(){if(!!this.f1())throw new Error("Invalid data");const n=this.f(4),o=!!this.f1(),s=!!this.f1();this.f1();let l;return o&&(l=this.obuExtensionHeader()),{obu_type:n,obu_extension_flag:o,obu_has_size_field:s,obu_extension_header:l}}obuExtensionHeader(){const i=this.f(3),n=this.f(2);return this.skip(3),{temporal_id:i,spatial_id:n}}sequenceHeaderObu(){const i=this.f(3),n=!!this.f1(),o=!!this.f1();let s=!1,l,f=!1,c,r=!1,y=0;const b=[],u=[],m=[],x=[],E=[];let v,p;if(o)b[0]=0,u[0]=this.f(5),m[0]=0,x[0]=!1,E[0]=!1;else{s=!!this.f1(),s&&(l=this.timingInfo(),f=!!this.f1(),f&&(c=this.decoderModelInfo(),v=[])),r=!!this.f1(),r&&(p=[]),y=this.f(5);for(let M=0;M<=y;M+=1)b[M]=this.f(12),u[M]=this.f(5),u[M]>7?m[M]=this.f1():m[M]=0,f?(x[M]=!!this.f1(),x[M]&&(v[M]=this.operatingParametersInfo(c))):x[M]=!1,r&&(E[M]=!!this.f1(),E[M]&&(p[M]=this.f(4)))}const G=this.chooseOperatingPoint();h(this,se,b[G]);const w=this.f(4),P=this.f(4),T=this.f(w+1),S=this.f(P+1);let g=!1,L,d;o||(g=!!this.f1(),g&&(L=this.f(4),d=this.f(3)));const N=!!this.f1(),a=!!this.f1(),ae=!!this.f1();let j=!1,D=!1,F=!1,ie=!1,W=!1,Q=!1,$=!1,V=!1,Z=B.SelectScreenContentTools,X=!1,ee=B.SelectIntegerMv,Y;o||(j=!!this.f1(),D=!!this.f1(),F=!!this.f1(),ie=!!this.f1(),W=!!this.f1(),W&&(Q=!!this.f1(),$=!!this.f1()),V=!!this.f1(),V||(Z=this.f1()),Z>0&&(X=!!this.f1(),X||(ee=this.f1())),W&&(Y=this.f(3)));const te=!!this.f1(),ue=!!this.f1(),fe=!!this.f1(),me=this.colorConfig(i),de=!!this.f1();return{seq_profile:i,still_picture:n,reduced_still_picture_header:o,timing_info_present_flag:s,timing_info:l,decoder_model_info_present_flag:f,decoder_model_info:c,initial_display_delay_present_flag:r,initial_display_delay_minus_1:p,operating_points_cnt_minus_1:y,operating_point_idc:b,seq_level_idx:u,seq_tier:m,decoder_model_present_for_this_op:x,operating_parameters_info:v,initial_display_delay_present_for_this_op:E,frame_width_bits_minus_1:w,frame_height_bits_minus_1:P,max_frame_width_minus_1:T,max_frame_height_minus_1:S,frame_id_numbers_present_flag:g,delta_frame_id_length_minus_2:L,additional_frame_id_length_minus_1:d,use_128x128_superblock:N,enable_filter_intra:a,enable_intra_edge_filter:ae,enable_interintra_compound:j,enable_masked_compound:D,enable_warped_motion:F,enable_dual_filter:ie,enable_order_hint:W,enable_jnt_comp:Q,enable_ref_frame_mvs:$,seq_choose_screen_content_tools:V,seq_force_screen_content_tools:Z,seq_choose_integer_mv:X,seq_force_integer_mv:ee,order_hint_bits_minus_1:Y,enable_superres:te,enable_cdef:ue,enable_restoration:fe,color_config:me,film_grain_params_present:de}}searchSequenceHeaderObu(){for(;!this.ended;){const i=this.openBitstreamUnit();if(i&&i.sequence_header_obu)return i.sequence_header_obu}}timingInfo(){const i=this.f(32),n=this.f(32),o=!!this.f1();let s;return o&&(s=this.uvlc()),{num_units_in_display_tick:i,time_scale:n,equal_picture_interval:o,num_ticks_per_picture_minus_1:s}}decoderModelInfo(){const i=this.f(5),n=this.f(32),o=this.f(5),s=this.f(5);return{buffer_delay_length_minus_1:i,num_units_in_decoding_tick:n,buffer_removal_time_length_minus_1:o,frame_presentation_time_length_minus_1:s}}operatingParametersInfo(i){const n=i.buffer_delay_length_minus_1+1,o=this.f(n),s=this.f(n),l=!!this.f1();return{decoder_buffer_delay:o,encoder_buffer_delay:s,low_delay_mode_flag:l}}chooseOperatingPoint(){return 0}colorConfig(i){const n=!!this.f1();let o=!1,s=8;i===2&&n?(o=!!this.f1(),s=o?12:10):i<=2&&(s=n?10:8);let l=!1;i===1&&(l=!!this.f1());const f=!!this.f1();let c=B.ColorPrimaries.Unspecified,r=B.TransferCharacteristics.Unspecified,y=B.MatrixCoefficients.Unspecified;f&&(c=this.f(8),r=this.f(8),y=this.f(8));let b=!1,u,m,x=0,E=!1;if(l)b=!!this.f1(),u=!0,m=!0;else{if(c===B.ColorPrimaries.Bt709&&r===B.TransferCharacteristics.Srgb&&y===B.MatrixCoefficients.Identity)b=!0,u=!1,m=!1;else{switch(b=!!this.f1(),i){case 0:u=!0,m=!0;break;case 1:u=!1,m=!1;break;default:s==12?(u=!!this.f1(),u?m=!!this.f1():m=!1):(u=!0,m=!1);break}u&&m&&(x=this.f(2))}E=!!this.f1()}return{high_bitdepth:n,twelve_bit:o,BitDepth:s,mono_chrome:l,color_description_present_flag:f,color_primaries:c,transfer_characteristics:r,matrix_coefficients:y,color_range:b,subsampling_x:u,subsampling_y:m,chroma_sample_position:x,separate_uv_delta_q:E}}};oe=new WeakMap,se=new WeakMap,ne(B,"ObuType",Fe),ne(B,"ColorPrimaries",We),ne(B,"TransferCharacteristics",Ve),ne(B,"MatrixCoefficients",Ze),ne(B,"SelectScreenContentTools",2),ne(B,"SelectIntegerMv",2);let Ce=B;function*ze(t){let e=-1,i=0,n=!1;for(let o=0;o<t.length;o+=1){const s=t[o];if(n){if(s>3)throw new Error("Invalid data");n=!1;continue}if(s===0){i+=1;continue}const l=i;if(i=0,e===-1){if(l>=2&&s===1){e=o+1;continue}throw new Error("Invalid data")}if(!(l<2)){if(s===1){yield t.subarray(e,o-l),e=o+1;continue}if(l>2)throw new Error("Invalid data");switch(s){case 2:throw new Error("Invalid data");case 3:n=!0;break}}}if(n)throw new Error("Invalid data");yield t.subarray(e,t.length)}var ce,_e,le,J,R,I,K,H,re,pe,Le,Ne;class he{constructor(e){q(this,H);q(this,ce);q(this,_e);q(this,le);q(this,J,0);q(this,R,0);q(this,I,7);q(this,K,0);h(this,ce,e);for(let i=e.length-1;i>=0;i-=1){if(_(this,ce)[i]===0)continue;const n=e[i];for(let o=0;o<8;o+=1)if((n>>o&1)===1){h(this,_e,i),h(this,le,o),z(this,H,re).call(this);return}}throw new Error("Stop bit not found")}get byteLength(){return _(this,_e)}get stopBitIndex(){return _(this,le)}get bytePosition(){return _(this,R)}get bitPosition(){return _(this,I)}get ended(){return _(this,R)>=_(this,_e)&&_(this,I)<=_(this,le)}next(){if(this.ended)throw new Error("Bit index out of bounds");const e=_(this,K)>>_(this,I)&1;return h(this,I,_(this,I)-1),_(this,I)<0&&(h(this,R,_(this,R)+1),h(this,I,7),z(this,H,re).call(this)),e}read(e){if(e>32)throw new Error("Read length too large");let i=0;for(let n=0;n<e;n+=1)i=i<<1|this.next();return i}skip(e){if(e<=_(this,I)+1){h(this,I,_(this,I)-e),z(this,H,pe).call(this);return}for(e-=_(this,I)+1,h(this,R,_(this,R)+1),h(this,I,7),z(this,H,re).call(this),z(this,H,pe).call(this);e>=8;e-=8)h(this,R,_(this,R)+1),z(this,H,re).call(this),z(this,H,pe).call(this);h(this,I,7-e),z(this,H,pe).call(this)}decodeExponentialGolombNumber(){let e=0;for(;this.next()===0;)e+=1;return e===0?0:(1<<e|this.read(e))-1}peek(e){const i=z(this,H,Le).call(this),n=this.read(e);return z(this,H,Ne).call(this,i),n}readBytes(e){const i=new Uint8Array(e);for(let n=0;n<e;n+=1)i[n]=this.read(8);return i}peekBytes(e){const i=z(this,H,Le).call(this),n=this.readBytes(e);return z(this,H,Ne).call(this,i),n}}ce=new WeakMap,_e=new WeakMap,le=new WeakMap,J=new WeakMap,R=new WeakMap,I=new WeakMap,K=new WeakMap,H=new WeakSet,re=function(){if(h(this,K,_(this,ce)[_(this,R)]),_(this,J)===2&&_(this,K)===3){h(this,J,0),h(this,R,_(this,R)+1),z(this,H,re).call(this);return}_(this,K)===0?h(this,J,_(this,J)+1):h(this,J,0)},pe=function(){if(_(this,R)>=_(this,_e)&&_(this,I)<_(this,le))throw new Error("Bit index out of bounds")},Le=function(){return{zeroCount:_(this,J),bytePosition:_(this,R),bitPosition:_(this,I),byte:_(this,K)}},Ne=function(e){h(this,J,e.zeroCount),h(this,R,e.bytePosition),h(this,I,e.bitPosition),h(this,K,e.byte)};const mt={Baseline:1,Main:2,Extended:4,High:8,High10:16,High422:32,High444:64,ConstrainedBaseline:65536,ConstrainedHigh:1<<19},dt={Level1:1,Level1b:2,Level11:4,Level12:8,Level13:16,Level2:32,Level21:64,Level22:128,Level3:256,Level31:512,Level32:1024,Level4:2048,Level41:4096,Level42:8192,Level5:16384,Level51:32768,Level52:65536,Level6:1<<17,Level61:1<<18,Level62:1<<19};function Xe(t){const e=new he(t);if(e.next()!==0)throw new Error("Invalid data");const i=e.read(2);if(e.read(5)!==7)throw new Error("Invalid data");if(i===0)throw new Error("Invalid data");const o=e.read(8),s=e.peek(8),l=!!e.next(),f=!!e.next(),c=!!e.next(),r=!!e.next(),y=!!e.next(),b=!!e.next();if(e.read(2)!==0)throw new Error("Invalid data");const u=e.read(8),m=e.decodeExponentialGolombNumber();if(o===100||o===110||o===122||o===244||o===44||o===83||o===86||o===118||o===128||o===138||o===139||o===134){const g=e.decodeExponentialGolombNumber();if(g===3&&e.next(),e.decodeExponentialGolombNumber(),e.decodeExponentialGolombNumber(),e.next(),!!e.next())for(let d=0;d<(g!==3?8:12);d+=1)e.next()}e.decodeExponentialGolombNumber();const x=e.decodeExponentialGolombNumber();if(x===0)e.decodeExponentialGolombNumber();else if(x===1){e.next(),e.decodeExponentialGolombNumber(),e.decodeExponentialGolombNumber();const g=e.decodeExponentialGolombNumber();for(let L=0;L<g;L+=1)e.decodeExponentialGolombNumber()}e.decodeExponentialGolombNumber(),e.next();const E=e.decodeExponentialGolombNumber(),v=e.decodeExponentialGolombNumber(),p=e.next();p||e.next(),e.next();const G=!!e.next();let w,P,T,S;return G?(w=e.decodeExponentialGolombNumber(),P=e.decodeExponentialGolombNumber(),T=e.decodeExponentialGolombNumber(),S=e.decodeExponentialGolombNumber()):(w=0,P=0,T=0,S=0),e.next(),{profile_idc:o,constraint_set:s,constraint_set0_flag:l,constraint_set1_flag:f,constraint_set2_flag:c,constraint_set3_flag:r,constraint_set4_flag:y,constraint_set5_flag:b,level_idc:u,seq_parameter_set_id:m,pic_width_in_mbs_minus1:E,pic_height_in_map_units_minus1:v,frame_mbs_only_flag:p,frame_cropping_flag:G,frame_crop_left_offset:w,frame_crop_right_offset:P,frame_crop_top_offset:T,frame_crop_bottom_offset:S}}function Ye(t){let e,i;for(const n of ze(t))switch(n[0]&31){case 7:if(e=n,i)return{sequenceParameterSet:e,pictureParameterSet:i};break;case 8:if(i=n,e)return{sequenceParameterSet:e,pictureParameterSet:i};break}throw new Error("Invalid data")}function pt(t){const{sequenceParameterSet:e,pictureParameterSet:i}=Ye(t),{profile_idc:n,constraint_set:o,level_idc:s,pic_width_in_mbs_minus1:l,pic_height_in_map_units_minus1:f,frame_mbs_only_flag:c,frame_crop_left_offset:r,frame_crop_right_offset:y,frame_crop_top_offset:b,frame_crop_bottom_offset:u}=Xe(e),m=(l+1)*16,x=(f+1)*(2-c)*16,E=r*2,v=y*2,p=b*2,G=u*2,w=m-E-v,P=x-p-G;return{pictureParameterSet:i,sequenceParameterSet:e,profileIndex:n,constraintSet:o,levelIndex:s,encodedWidth:m,encodedHeight:x,cropLeft:E,cropRight:v,cropTop:p,cropBottom:G,croppedWidth:w,croppedHeight:P}}const ut={Main:1,Main10:2,MainStill:4,Main10Hdr10:4096,Main10Hdr10Plus:8192},ht={MainTierLevel1:1,HighTierLevel1:2,MainTierLevel2:4,HighTierLevel2:8,MainTierLevel21:16,HighTierLevel21:32,MainTierLevel3:64,HighTierLevel3:128,MainTierLevel31:256,HighTierLevel31:512,MainTierLevel4:1024,HighTierLevel4:2048,MainTierLevel41:4096,HighTierLevel41:8192,MainTierLevel5:16384,HighTierLevel5:32768,MainTierLevel51:65536,HighTierLevel51:1<<17,MainTierLevel52:1<<18,HighTierLevel52:1<<19,MainTierLevel6:1<<20,HighTierLevel6:1<<21,MainTierLevel61:1<<22,HighTierLevel61:1<<23,MainTierLevel62:1<<24,HighTierLevel62:1<<25};function Je(t){switch(t){case 0:case 3:return 1;case 1:case 2:return 2;default:throw new Error("Invalid chroma_format_idc")}}function Ke(t){switch(t){case 0:case 2:case 3:return 1;case 1:return 2;default:throw new Error("Invalid chroma_format_idc")}}function Qe(t){const e=new he(t);if(e.next()!==0)throw new Error("Invalid NALU header");const i=e.read(6),n=e.read(6),o=e.read(3);return{nal_unit_type:i,nuh_layer_id:n,nuh_temporal_id_plus1:o}}function $e(t){const e=new he(t),i=e.read(4),n=!!e.next(),o=!!e.next(),s=e.read(6),l=e.read(3),f=!!e.next();e.skip(16);const c=Ue(e,!0,l),r=!!e.next(),y=[],b=[],u=[];for(let N=r?0:l;N<=l;N+=1)y[N]=e.decodeExponentialGolombNumber(),b[N]=e.decodeExponentialGolombNumber(),u[N]=e.decodeExponentialGolombNumber();const m=e.read(6),x=e.decodeExponentialGolombNumber(),E=[];for(let N=1;N<=x;N+=1){E[N]=[];for(let a=0;a<=m;a+=1)E[N][a]=!!e.next()}const v=!!e.next();let p,G,w,P,T,S,g,L;if(v){p=e.read(32),G=e.read(32),w=!!e.next(),w&&(P=e.decodeExponentialGolombNumber()),T=e.decodeExponentialGolombNumber(),S=[],g=[!0],L=[];for(let N=0;N<T;N+=1)S[N]=e.decodeExponentialGolombNumber(),N>0&&(g[N]=!!e.next()),L[N]=Re(e,g[N],l)}const d=!!e.next();return{vps_video_parameter_set_id:i,vps_base_layer_internal_flag:n,vps_base_layer_available_flag:o,vps_max_layers_minus1:s,vps_max_sub_layers_minus1:l,vps_temporal_id_nesting_flag:f,profileTierLevel:c,vps_sub_layer_ordering_info_present_flag:r,vps_max_dec_pic_buffering_minus1:y,vps_max_num_reorder_pics:b,vps_max_latency_increase_plus1:u,vps_max_layer_id:m,vps_num_layer_sets_minus1:x,layer_id_included_flag:E,vps_timing_info_present_flag:v,vps_num_units_in_tick:p,vps_time_scale:G,vps_poc_proportional_to_timing_flag:w,vps_num_ticks_poc_diff_one_minus1:P,vps_num_hrd_parameters:T,hrd_layer_set_idx:S,cprms_present_flag:g,hrdParameters:L,vps_extension_flag:d}}function et(t){const e=new he(t),i=e.read(4),n=e.read(3),o=!!e.next(),s=Ue(e,!0,n),l=e.decodeExponentialGolombNumber(),f=e.decodeExponentialGolombNumber();let c;f===3&&(c=!!e.next());const r=e.decodeExponentialGolombNumber(),y=e.decodeExponentialGolombNumber(),b=!!e.next();let u,m,x,E;b&&(u=e.decodeExponentialGolombNumber(),m=e.decodeExponentialGolombNumber(),x=e.decodeExponentialGolombNumber(),E=e.decodeExponentialGolombNumber());const v=e.decodeExponentialGolombNumber(),p=e.decodeExponentialGolombNumber(),G=e.decodeExponentialGolombNumber(),w=[],P=[],T=[],S=!!e.next();for(let k=S?0:n;k<=n;k+=1)w[k]=e.decodeExponentialGolombNumber(),P[k]=e.decodeExponentialGolombNumber(),T[k]=e.decodeExponentialGolombNumber();const g=e.decodeExponentialGolombNumber(),L=e.decodeExponentialGolombNumber(),d=e.decodeExponentialGolombNumber(),N=e.decodeExponentialGolombNumber(),a=e.decodeExponentialGolombNumber(),ae=e.decodeExponentialGolombNumber(),j=!!e.next();let D,F;j&&(D=!!e.next(),D&&(F=tt(e)));const ie=!!e.next(),W=!!e.next(),Q=!!e.next();let $,V,Z,X,ee;Q&&($=e.read(4),V=e.read(4),Z=e.decodeExponentialGolombNumber(),X=e.decodeExponentialGolombNumber(),ee=!!e.next());const Y=e.decodeExponentialGolombNumber(),te=[];for(let k=0;k<Y;k+=1)te[k]=it(e,k,Y,te);const ue=!!e.next();let fe,me,de;if(ue){fe=e.decodeExponentialGolombNumber(),me=[],de=[];for(let k=0;k<fe;k+=1)me[k]=e.read(G+4),de[k]=!!e.next()}const M=!!e.next(),Ae=!!e.next(),Ge=!!e.next();let Pe;Ge&&(Pe=ot(e,n));const Se=!!e.next();let be,ge,xe,ve,ye;if(Se&&(be=!!e.next(),ge=!!e.next(),xe=!!e.next(),ve=!!e.next(),ye=e.read(4)),be)throw new Error("Not implemented");let Te;ge&&(Te=_t(e));let Be;if(xe&&(Be=lt(e)),ve)throw new Error("Not implemented");let Ee;if(ye){Ee=[];let k=0;for(;!e.ended;)Ee[k]=!!e.next(),k+=1}return{sps_video_parameter_set_id:i,sps_max_sub_layers_minus1:n,sps_temporal_id_nesting_flag:o,profileTierLevel:s,sps_seq_parameter_set_id:l,chroma_format_idc:f,separate_colour_plane_flag:c,pic_width_in_luma_samples:r,pic_height_in_luma_samples:y,conformance_window_flag:b,conf_win_left_offset:u,conf_win_right_offset:m,conf_win_top_offset:x,conf_win_bottom_offset:E,bit_depth_luma_minus8:v,bit_depth_chroma_minus8:p,log2_max_pic_order_cnt_lsb_minus4:G,sps_sub_layer_ordering_info_present_flag:S,sps_max_dec_pic_buffering_minus1:w,sps_max_num_reorder_pics:P,sps_max_latency_increase_plus1:T,log2_min_luma_coding_block_size_minus3:g,log2_diff_max_min_luma_coding_block_size:L,log2_min_luma_transform_block_size_minus2:d,log2_diff_max_min_luma_transform_block_size:N,max_transform_hierarchy_depth_inter:a,max_transform_hierarchy_depth_intra:ae,scaling_list_enabled_flag:j,sps_scaling_list_data_present_flag:D,scalingListData:F,amp_enabled_flag:ie,sample_adaptive_offset_enabled_flag:W,pcm_enabled_flag:Q,pcm_sample_bit_depth_luma_minus1:$,pcm_sample_bit_depth_chroma_minus1:V,log2_min_pcm_luma_coding_block_size_minus3:Z,log2_diff_max_min_pcm_luma_coding_block_size:X,pcm_loop_filter_disabled_flag:ee,num_short_term_ref_pic_sets:Y,shortTermRefPicSets:te,long_term_ref_pics_present_flag:ue,num_long_term_ref_pics_sps:fe,lt_ref_pic_poc_lsb_sps:me,used_by_curr_pic_lt_sps_flag:de,sps_temporal_mvp_enabled_flag:M,strong_intra_smoothing_enabled_flag:Ae,vui_parameters_present_flag:Ge,vuiParameters:Pe,sps_extension_present_flag:Se,sps_range_extension_flag:be,sps_multilayer_extension_flag:ge,sps_3d_extension_flag:xe,sps_scc_extension_flag:ve,sps_extension_4bits:ye,spsMultilayerExtension:Te,sps3dExtension:Be,sps_extension_data_flag:Ee}}function Ie(t){const e=t.read(2),i=!!t.next(),n=t.read(5),o=t.peekBytes(4),s=[];for(let S=0;S<32;S+=1)s[S]=!!t.next();const l=t.peekBytes(6),f=!!t.next(),c=!!t.next(),r=!!t.next(),y=!!t.next();let b,u,m,x,E,v,p,G,w,P;n===4||s[4]||n===5||s[5]||n===6||s[6]||n===7||s[7]||n===8||s[8]||n===9||s[9]||n===10||s[10]||n===11||s[11]?(b=!!t.next(),u=!!t.next(),m=!!t.next(),x=!!t.next(),E=!!t.next(),v=!!t.next(),p=!!t.next(),G=!!t.next(),w=!!t.next(),n===5||s[5]||n===9||s[9]||n===10||s[10]||n===11||s[11]?(P=!!t.next(),t.skip(33)):t.skip(34)):n===2||s[2]?(t.skip(7),G=!!t.next(),t.skip(35)):t.skip(43);let T;return n===1||s[1]||n===2||s[2]||n===3||s[3]||n===4||s[4]||n===5||s[5]||n===9||s[9]||n===11||s[11]?T=!!t.next():t.skip(1),{profile_space:e,tier_flag:i,profile_idc:n,profileCompatibilitySet:o,profile_compatibility_flag:s,constraintSet:l,progressive_source_flag:f,interlaced_source_flag:c,non_packed_constraint_flag:r,frame_only_constraint_flag:y,max_12bit_constraint_flag:b,max_10bit_constraint_flag:u,max_8bit_constraint_flag:m,max_422chroma_constraint_flag:x,max_420chroma_constraint_flag:E,max_monochrome_constraint_flag:v,intra_constraint_flag:p,one_picture_only_constraint_flag:G,lower_bit_rate_constraint_flag:w,max_14bit_constraint_flag:P,inbld_flag:T}}function Ue(t,e,i){let n;n=Ie(t);const o=t.read(8),s=[],l=[];for(let r=0;r<i;r+=1)s[r]=!!t.next(),l[r]=!!t.next();if(i>0)for(let r=i;r<8;r+=1)t.read(2);const f=[],c=[];for(let r=0;r<i;r+=1)s[r]&&(f[r]=Ie(t)),l[r]&&(c[r]=t.read(8));return{generalProfileTier:n,general_level_idc:o,sub_layer_profile_present_flag:s,sub_layer_level_present_flag:l,subLayerProfileTier:f,sub_layer_level_idc:c}}function tt(t){const e=[];for(let i=0;i<4;i+=1){e[i]=[];for(let n=0;n<6;n+=i===3?3:1)if(!!!t.next())t.decodeExponentialGolombNumber();else{let s=8;const l=Math.min(64,1<<4+(i<<1));i>1&&(s=t.decodeExponentialGolombNumber()+8),e[i][n]=[];for(let f=0;f<l;f+=1){const c=t.decodeExponentialGolombNumber();s=(s+c+256)%256,e[i][n][f]=s}}}return e}function it(t,e,i,n){let o=!1;e!==0&&(o=!!t.next());let s=0,l=!1,f=0;const c=[],r=[];let y=0,b=0;const u=[],m=[],x=[],E=[];if(o){e===i&&(s=t.decodeExponentialGolombNumber()),l=!!t.next(),f=t.decodeExponentialGolombNumber();const v=e-(s+1),p=n[v],G=p.num_negative_pics+p.num_positive_pics;for(let a=0;a<=G;a+=1)c[a]=!!t.next(),c[a]?r[a]=!0:r[a]=!!t.next();const w=(1-2*Number(l))*(f+1),P=[],T=[],S=[],g=[];let L=0;for(let a=0;a<p.num_negative_pics;a+=1)L-=p.delta_poc_s0_minus1[a]+1,P[a]=L;L=0;for(let a=0;a<p.num_positive_pics;a+=1)L+=p.delta_poc_s1_minus1[a]+1,T[a]=L;let d=0;if(p.num_positive_pics>0)for(let a=p.num_positive_pics-1;a>=0;a-=1)L=T[a]+w,L<0&&r[p.num_negative_pics+a]&&(S[d]=L,m[d]=c[p.num_negative_pics+a],d+=1);w<0&&r[G]&&(S[d]=w,m[d]=c[G],d+=1);for(let a=0;a<p.num_negative_pics;a+=1)L=P[a]+w,L<0&&r[a]&&(S[d]=L,m[d]=c[a],d+=1);y=d;let N=0;for(d=0;d<y;d+=1){const a=S[d];u[d]=-(a-N-1),N=a}if(d=0,p.num_negative_pics>0)for(let a=p.num_negative_pics-1;a>=0;a-=1)L=P[a]+w,L>0&&r[a]&&(g[d]=L,E[d]=c[a],d+=1);w>0&&r[G]&&(g[d]=w,E[d]=c[G],d+=1);for(let a=0;a<p.num_positive_pics;a+=1)L=T[a]+w,L>0&&r[p.num_negative_pics+a]&&(g[d]=L,E[d]=c[p.num_negative_pics+a],d+=1);for(b=d,N=0,d=0;d<b;d+=1){const a=g[d];x[d]=a-N-1,N=a}}else{y=t.decodeExponentialGolombNumber(),b=t.decodeExponentialGolombNumber();for(let v=0;v<y;v+=1)u[v]=t.decodeExponentialGolombNumber(),m[v]=!!t.next();for(let v=0;v<b;v+=1)x[v]=t.decodeExponentialGolombNumber(),E[v]=!!t.next()}return{stRpsIdx:e,num_short_term_ref_pic_sets:i,inter_ref_pic_set_prediction_flag:o,delta_idx_minus1:s,delta_rps_sign:l,abs_delta_rps_minus1:f,used_by_curr_pic_flag:c,use_delta_flag:r,num_negative_pics:y,num_positive_pics:b,delta_poc_s0_minus1:u,used_by_curr_pic_s0_flag:m,delta_poc_s1_minus1:x,used_by_curr_pic_s1_flag:E}}const nt={Unspecified:0,Square:1,_12_11:2,_10_11:3,_16_11:4,_40_33:5,_24_11:6,_20_11:7,_32_11:8,_80_33:9,_18_11:10,_15_11:11,_64_33:12,_160_99:13,_4_3:15,_3_2:16,_2_1:17,Extended:255};function ot(t,e){const i=!!t.next();let n,o,s;i&&(n=t.read(8),n===nt.Extended&&(o=t.read(16),s=t.read(16)));const l=!!t.next();let f;l&&(f=!!t.next());const c=!!t.next();let r,y,b,u,m,x;c&&(r=t.read(3),y=!!t.next(),b=!!t.next(),b&&(u=t.read(8),m=t.read(8),x=t.read(8)));const E=!!t.next();let v,p;E&&(v=t.decodeExponentialGolombNumber(),p=t.decodeExponentialGolombNumber());const G=!!t.next(),w=!!t.next(),P=!!t.next(),T=!!t.next();let S,g,L,d;T&&(S=t.decodeExponentialGolombNumber(),g=t.decodeExponentialGolombNumber(),L=t.decodeExponentialGolombNumber(),d=t.decodeExponentialGolombNumber());const N=!!t.next();let a,ae,j,D,F,ie;N&&(a=t.read(32),ae=t.read(32),j=!!t.next(),j&&(D=t.decodeExponentialGolombNumber()),F=!!t.next(),F&&(ie=Re(t,!0,e)));const W=!!t.next();let Q,$,V,Z,X,ee,Y,te;return W&&(Q=!!t.next(),$=!!t.next(),V=!!t.next(),Z=t.decodeExponentialGolombNumber(),X=t.decodeExponentialGolombNumber(),ee=t.decodeExponentialGolombNumber(),Y=t.decodeExponentialGolombNumber(),te=t.decodeExponentialGolombNumber()),{aspect_ratio_info_present_flag:i,aspect_ratio_idc:n,sar_width:o,sar_height:s,overscan_info_present_flag:l,overscan_appropriate_flag:f,video_signal_type_present_flag:c,video_format:r,video_full_range_flag:y,colour_description_present_flag:b,colour_primaries:u,transfer_characteristics:m,matrix_coeffs:x,chroma_loc_info_present_flag:E,chroma_sample_loc_type_top_field:v,chroma_sample_loc_type_bottom_field:p,neutral_chroma_indication_flag:G,field_seq_flag:w,frame_field_info_present_flag:P,default_display_window_flag:T,def_disp_win_left_offset:S,def_disp_win_right_offset:g,def_disp_win_top_offset:L,def_disp_win_bottom_offset:d,vui_timing_info_present_flag:N,vui_num_units_in_tick:a,vui_time_scale:ae,vui_poc_proportional_to_timing_flag:j,vui_num_ticks_poc_diff_one_minus1:D,vui_hrd_parameters_present_flag:F,vui_hrd_parameters:ie,bitstream_restriction_flag:W,tiles_fixed_structure_flag:Q,motion_vectors_over_pic_boundaries_flag:$,restricted_ref_pic_lists_flag:V,min_spatial_segmentation_idc:Z,max_bytes_per_pic_denom:X,max_bits_per_min_cu_denom:ee,log2_max_mv_length_horizontal:Y,log2_max_mv_length_vertical:te}}function Re(t,e,i){let n,o,s,l,f,c,r,y,b,u,m,x,E;e&&(n=!!t.next(),o=!!t.next(),(n||o)&&(s=!!t.next(),s&&(l=t.read(8),f=t.read(5),c=!!t.next(),r=t.read(5)),y=t.read(4),b=t.read(4),s&&(u=t.read(4)),m=t.read(5),x=t.read(5),E=t.read(5)));const v=[],p=[],G=[],w=[],P=[],T=[],S=[];for(let g=0;g<=i;g+=1)v[g]=!!t.next(),v[g]||(p[g]=!!t.next()),p[g]?G[g]=t.decodeExponentialGolombNumber():w[g]=!!t.next(),w[g]||(P[g]=t.decodeExponentialGolombNumber()),n&&(T[g]=Me(t,g,qe(P[g]))),o&&(S[g]=Me(t,g,qe(P[g])));return{nal_hrd_parameters_present_flag:n,vcl_hrd_parameters_present_flag:o,sub_pic_hrd_params_present_flag:s,tick_divisor_minus2:l,du_cpb_removal_delay_increment_length_minus1:f,sub_pic_cpb_params_in_pic_timing_sei_flag:c,dpb_output_delay_du_length_minus1:r,bit_rate_scale:y,cpb_size_scale:b,cpb_size_du_scale:u,initial_cpb_removal_delay_length_minus1:m,au_cpb_removal_delay_length_minus1:x,dpb_output_delay_length_minus1:E,fixed_pic_rate_general_flag:v,fixed_pic_rate_within_cvs_flag:p,elemental_duration_in_tc_minus1:G,low_delay_hrd_flag:w,cpb_cnt_minus1:P,nalHrdParameters:T,vclHrdParameters:S}}function Me(t,e,i){const n=[],o=[],s=[],l=[],f=[];for(let c=0;c<i;c+=1)n[c]=t.decodeExponentialGolombNumber(),o[c]=t.decodeExponentialGolombNumber(),e>0&&(f[c]=!!t.next());return{bit_rate_value_minus1:n,cpb_size_value_minus1:o,cpb_size_du_value_minus1:s,bit_rate_du_value_minus1:l,cbr_flag:f}}function qe(t){return t+1}function st(t){let e,i,n,o=0;for(const s of ze(t)){const l=Qe(s),f={...l,data:s,rbsp:s.subarray(2)};switch(l.nal_unit_type){case 32:e=f;break;case 33:i=f;break;case 34:n=f;break;default:continue}if(o+=1,o===3)return{videoParameterSet:e,sequenceParameterSet:i,pictureParameterSet:n}}throw new Error("Invalid data")}function _t(t){return{inter_view_mv_vert_constraint_flag:!!t.next()}}function lt(t){const e=[],i=[];e[0]=!!t.next(),i[0]=!!t.next();const n=t.decodeExponentialGolombNumber(),o=!!t.next(),s=!!t.next(),l=!!t.next(),f=!!t.next();e[1]=!!t.next(),i[1]=!!t.next();const c=!!t.next(),r=t.decodeExponentialGolombNumber(),y=!!t.next(),b=!!t.next(),u=!!t.next(),m=!!t.next(),x=!!t.next();return{iv_di_mc_enabled_flag:e,iv_mv_scal_enabled_flag:i,log2_ivmc_sub_pb_size_minus3:n,iv_res_pred_enabled_flag:o,depth_ref_enabled_flag:s,vsp_mc_enabled_flag:l,dbbp_enabled_flag:f,tex_mc_enabled_flag:c,log2_texmc_sub_pb_size_minus3:r,intra_contour_enabled_flag:y,intra_dc_only_wedge_enabled_flag:b,cqt_cu_part_pred_enabled_flag:u,inter_dc_only_enabled_flag:m,skip_intra_enabled_flag:x}}function bt(t){const{videoParameterSet:e,sequenceParameterSet:i,pictureParameterSet:n}=st(t),{profileTierLevel:{generalProfileTier:{profile_space:o,tier_flag:s,profile_idc:l,profileCompatibilitySet:f,constraintSet:c},general_level_idc:r}}=$e(e.rbsp),{chroma_format_idc:y,pic_width_in_luma_samples:b,pic_height_in_luma_samples:u,conf_win_left_offset:m=0,conf_win_right_offset:x=0,conf_win_top_offset:E=0,conf_win_bottom_offset:v=0}=et(i.rbsp),p=Je(y),G=Ke(y),w=b-p*(m+x),P=u-G*(E+v);return{videoParameterSet:e,sequenceParameterSet:i,pictureParameterSet:n,generalProfileSpace:o,generalProfileIndex:l,generalProfileCompatibilitySet:f,generalTierFlag:s,generalLevelIndex:r,generalConstraintSet:c,encodedWidth:b,encodedHeight:u,cropLeft:m,cropRight:x,cropTop:E,cropBottom:v,croppedWidth:w,croppedHeight:P}}export{Ce as A,nt as H,he as N,ke as S,bt as a,rt as b,ct as c,ft as d,mt as e,dt as f,Xe as g,pt as h,Ye as i,ut as j,ht as k,Je as l,Ke as m,Qe as n,$e as o,et as p,tt as q,it as r,ot as s,Re as t,Me as u,st as v,_t as w,lt as x,ze as y};

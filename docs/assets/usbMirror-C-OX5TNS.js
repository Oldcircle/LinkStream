const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-V_WUKhLh.js","assets/stream-BT4ImN5b.js","assets/distribution-vvPj2d0I.js","assets/struct-deserialize-bkGssrR1.js","assets/encoding-D3q_jWej.js","assets/string-Gn2dS4oc.js","assets/uint32-BfumdTHg.js","assets/reverse-D3S_M3ap.js","assets/sticky-event-emitter-B3ySTSV4.js","assets/index-tKmTrm3T.js","assets/3_3_2-DmD8R-J5.js","assets/h265-BZeEvzU-.js","assets/split-string-NR4_hcTk.js","assets/index-CrHIl016.js","assets/index-I0eqDM6x.js","assets/index-2XwGGKaH.js","assets/index-Di93NhIW.js"])))=>i.map(i=>d[i]);
import{_ as s}from"./index-2XwGGKaH.js";async function $(T,o){var v,y,h,S,g,_,A,B,D,U,E,I,N;let p=null;try{o("Requesting Android device via WebUSB...","info");try{const r=window.isSecureContext,c=navigator.userAgent;o(`Env: secure=${r} ua=${c}`,"info");const d=await((y=(v=navigator.usb).getDevices)==null?void 0:y.call(v));d&&o(`Known USB devices: ${d.length}`,"info")}catch{}const t=await s(()=>import("./index-CwCV73Rw.js"),[]),n=await s(()=>import("./index-V_WUKhLh.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8])),a=await s(()=>import("./index-tKmTrm3T.js"),__vite__mapDeps([9,10,3,1,5,6,11,12,8,7,4])),P=await s(()=>import("./index-CrHIl016.js"),__vite__mapDeps([13,10,3,1,5,6,11])),k=await s(()=>import("./index-I0eqDM6x.js"),__vite__mapDeps([14,11,6,8,1,15])),u=await s(()=>import("./index-Di93NhIW.js"),__vite__mapDeps([16,3,1,2,4,12]));if(!navigator.usb)throw new Error("WebUSB not available: use Chrome/Edge over HTTPS or localhost");const W=[{vendorId:6353},{vendorId:1256},{vendorId:4817},{vendorId:10007},{vendorId:10864},{vendorId:8921},{vendorId:11669}];let e;try{typeof((h=t.AdbWebUsbBackend)==null?void 0:h.requestDevice)=="function"?e=await t.AdbWebUsbBackend.requestDevice({filters:W}):e=await navigator.usb.requestDevice({filters:W})}catch(r){if((r==null?void 0:r.name)==="NotFoundError")o("No matching Android device found with filters, showing all devices...","info"),typeof((S=t.AdbWebUsbBackend)==null?void 0:S.requestDevice)=="function"?e=await t.AdbWebUsbBackend.requestDevice({filters:[]}):e=await navigator.usb.requestDevice({filters:[]});else throw r}if(!e)throw new Error("No device selected");try{const r={vendorId:(e==null?void 0:e.vendorId)??((g=e==null?void 0:e.device)==null?void 0:g.vendorId),productId:(e==null?void 0:e.productId)??((_=e==null?void 0:e.device)==null?void 0:_.productId),productName:(e==null?void 0:e.productName)??((A=e==null?void 0:e.device)==null?void 0:A.productName),manufacturerName:(e==null?void 0:e.manufacturerName)??((B=e==null?void 0:e.device)==null?void 0:B.manufacturerName),serialNumber:(e==null?void 0:e.serialNumber)??((D=e==null?void 0:e.device)==null?void 0:D.serialNumber)};o(`Selected device: ${JSON.stringify(r)}`,"info")}catch{}try{if(typeof e.open=="function"&&!e.opened&&await e.open(),typeof e.selectConfiguration=="function"&&e.configuration==null)try{await e.selectConfiguration(1)}catch{}}catch{}let m;if(typeof((U=t.AdbWebUsbBackend)==null?void 0:U.fromDevice)=="function")m=await t.AdbWebUsbBackend.fromDevice(e);else if(typeof t.AdbWebUsbBackend=="function")m=new t.AdbWebUsbBackend(e);else throw new Error("AdbWebUsbBackend not available");let f;try{f=await m.connect()}catch(r){throw String((r==null?void 0:r.message)||"").includes("claimInterface")&&o("Unable to claim USB ADB interface. On Windows, install WinUSB driver for the ADB interface (use Zadig or Google USB Driver), close OEM phone suites (HiSuite/Kies), replug the device, and ensure USB debugging is enabled.","error"),r}const l=new n.Adb(f);typeof l.connect=="function"&&await l.connect(),o("Starting scrcpy server on device...","info");const C=a.AdbScrcpyOptions2_1??a.AdbScrcpyOptions1_24,O=new C({video:{codec:"h264",maxSize:1080,bitRate:8e6,tunnel:"adb"},audio:!1,tunnelForward:!0});try{o(`scrcpy options: ${JSON.stringify({codec:"h264",maxSize:1080,bitRate:8e6,audio:!1,tunnel:"adb",tunnelForward:!0})}`,"info")}catch{}let i;try{i=await a.AdbScrcpyClient.start(l,P.DefaultServerPath,O)}catch{const c=new a.AdbScrcpyClient(l,O);try{i={streams:await c.start()}}catch(d){throw o("ADB unauthorized or scrcpy server failed to start. Please accept USB debugging dialog on device and try again.","error"),d}}if((E=i==null?void 0:i.output)!=null&&E.pipeTo&&(u!=null&&u.WritableStream))try{await i.output.pipeTo(new u.WritableStream({write(r){const c=typeof r=="string"?r:(()=>{try{return new TextDecoder().decode(r)}catch{return String(r)}})();o(`scrcpy: ${c}`,"info")}}))}catch{}const b=new k.ScrcpyDecoderWebCodecs({canvas:T}),w=i.videoStream??((I=i.streams)==null?void 0:I.video)??i.streams??i;if(!w)throw new Error("No video stream from scrcpy");o("Decoding H.264 stream via WebCodecs...","info"),typeof b.decode=="function"?b.decode(w):typeof b.render=="function"&&b.render(w),p=async()=>{try{typeof i.close=="function"&&await i.close(),typeof f.close=="function"&&await f.close()}catch{}},o("USB mirror started","success")}catch(t){console.error(t);let n="";(t==null?void 0:t.name)==="SecurityError"&&(n="SecurityError: use HTTPS (GitHub Pages) or localhost, and enable USB debugging."),(t==null?void 0:t.name)==="NotFoundError"&&(n="No device selected or no matching device; ensure phone is connected and unlocked."),(N=t==null?void 0:t.message)!=null&&N.includes("unauthorized")&&(n="Device unauthorized: accept the USB debugging prompt and check Developer options.");const a=JSON.stringify({name:t==null?void 0:t.name,message:t==null?void 0:t.message,stack:t==null?void 0:t.stack},null,2);throw o(`USB mirror failed: ${(t==null?void 0:t.message)||t}${n?" | "+n:""}
${a}`,"error"),t}return{stop:async()=>{p&&await p(),o("USB mirror stopped","info")}}}export{$ as startUsbMirror};
